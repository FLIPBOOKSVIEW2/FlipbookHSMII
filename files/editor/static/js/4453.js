"use strict";(self.webpackChunkeditor_cli=self.webpackChunkeditor_cli||[]).push([[4453],{64453:function(t,e,i){i.r(e),i.d(e,{default:function(){return d}});i(57658);var s=i(18023),a=i(1585),n=i(74463),o=i(24118),u=i(22582),l=i(76748);var c={name:"PlayAudio",components:{NoAudioIcon:()=>i.e(6332).then(i.bind(i,36332)),CloseIcon:()=>i.e(3994).then(i.bind(i,83994)),PauseIcon:()=>i.e(686).then(i.bind(i,60686)),PlayIcon:()=>i.e(1166).then(i.bind(i,1166))},mixins:[a.Z],data(){return{tryListenPlayAudioSrc:"",tryListenPlayAudioIndex:-1,playAudioSuffixList:["mp3","mp4"],playAudioMusicList:[],tryListenListIsPlaying:!1,isUploading:!1}},mounted(){this.getMusicList()},watch:{currentSelectedItem:{handler:function(){this.getMusicList()},immediate:!0,deep:!0}},computed:{playAudioUploadData:function(){let t={type:3,uid:this.$store.state.userData.uId};return this.isYZPro&&(t={type:3}),new n.Yo(t)},gradientColor:function(){return(0,u.b)()},rotateWhenPlayItems:function(){return this.$store.state.actionEventsListPanel.rotateWhenPlayItems},currentPageIndex:function(){return this.$store.state.pagePanel.currentIndex},acceptAudioType:function(){return this.$store.getters.acceptAudioType},acceptAudioTypeStr:function(){return this.acceptAudioType.map((t=>"mp3"===t?"audio/mp3":"mp4"===t?"video/mp4":void 0)).join(",")},selectOptions(){return[{value:1,label:"playAudio.localAudio",isShow:!0},{value:0,isShow:!0,label:"playAudio.audioLink"},{value:2,isShow:"pluginMusic"===this.currentSelectedItem.type&&"ended"===this.currentActionListItem.event,label:"playAudio2022_07_16.text1"}]}},methods:{showItemName:t=>{if(!t)return"";if(!t.musicList?.length||!t.musicList[0]?.name)return"";return`<span class="audio-name">${t.musicList[0].name.slice(0,t.musicList[0].name.lastIndexOf("."))}</span><span class="total">${l.ag.t("pluginMusic_20240430.text1",{total:t.musicList.length})}</span>`},getLabelName:t=>{if(!t)return"";if(!t.musicList?.length||!t.musicList[0]?.name)return"";return`${t.musicList[0].name.slice(0,t.musicList[0].name.lastIndexOf("."))}${l.ag.t("pluginMusic_20240430.text1",{total:t.musicList.length})}`},isHasPlayAudio:function(t,e=!1){return this.isHasAction&&!!Object.keys(this.actionList[t].playAudio).length},deletePlayAudio:function(t,e){this.saveBeforePage(),this.actionList[t].playAudio={},this.pausePlayAudio(),this.$store.commit(s.N23,{canUndo:!0})},pausePlayAudio:function(){this.tryListenPlayAudioIndex=-1,document.querySelectorAll(".play-audio").forEach((t=>{t.paused||(t.pause(),t.src="")}))},audioTypeChange:function(t,e){document.querySelectorAll(".play-audio").forEach((t=>{t.paused||t.pause()})),this.saveUndo()},playAudioUploadSuccess:function(t,e,i,a){this.isUploading=!1;let n=this.actionList[a].playAudio.audioList[0];n.localLink=e.response.fileSrc||e.response.filePath,n.fileName=o.Z.getPathFilename(n.localLink),n.name=e.name,n.uploadStatus=e.status,n.uid=e.uid,n.percentage=e.percentage,(this.isFlipPro||this.isH5Pro)&&(n.isNewFile=!0),this.$store.commit(s.N23,{canUndo:!0})},playAudioUploadError:function(t,e,i,s){this.isUploading=!1,t&&(this.actionList[s].playAudio.audioList="error")},playAudioProgress:function(t,e,i,s){this.isUploading=!0;let a=this.actionList[s].playAudio.audioList[0];a.percentage=e.percentage,100!==a.percentage&&(a.uploadStatus="uploading")},playAudioCheckSuffix:function(t,e){let i=o.Z.getPathFileSuffix(t.name);return!!this.playAudioSuffixList.includes(i)||(this.$refs.playAudioUpload[0].abort(t),e&&(this.playAudioWarningMsg&&this.playAudioWarningMsg.close(),this.playAudioWarningMsg=this.$message({showClose:!0,message:this.$i18n.t("playAudio.uploadFormatLimit"),type:"warning",duration:1500})),!1)},addNewPlayAudio:function(t,e){if(this.saveBeforePage(),!this.playAudioCheckSuffix(t,!0))return!1;{this.$refs.playAudioDemo.paused||(this.tryListenPlayAudioIndex=-1,this.$refs.playAudioDemo.pause());let i={name:t.name,fileName:"",localLink:"",percentage:0,uploadStatus:"",isNewFile:!0,uid:""};t.uid&&(i.uid=t.uid),this.actionList[e].playAudio.audioList=[],this.actionList[e].playAudio.audioList.push(i)}},playAudioUploadProgressStyle:function(t,e){let i=[],s=this.actionList[t].playAudio.audioList[e],a={};if("success"!==s.uploadStatus){let t=`linear-gradient(to right, ${this.gradientColor} ${s.percentage}%, rgb(255, 255, 255) ${s.percentage}%, rgb(255, 255, 255) 100%`;a.background=t,a.color="#ffffff"}return i.push(a),i},listenPlayAudio:function(t,e){this.tryListenPlayAudioIndex===e?(this.tryListenPlayAudioIndex=-1,this.$refs.playAudioDemo.pause()):(this.tryListenPlayAudioIndex=e,this.tryListenPlayAudioSrc=t.localLink,this.$nextTick((()=>{this.$refs.playAudioDemo.load(),this.$refs.playAudioDemo.play()})))},editPlayAudioItem:function(t,e,i,a){this.saveBeforePage();let n=this.actionList[t].playAudio.audioList;"delete"===a&&("success"===e.uploadStatus&&(this.tryListenPlayAudioIndex===i&&(this.tryListenPlayAudioIndex=-1),n.splice(i,1),this.$store.commit(s.N23,{canUndo:!0})),"error"===e.uploadStatus&&n.splice(i,1)),"cancelImport"===a&&(this.$refs.playAudioUpload[0].abort(n[i]),n.splice(i,1)),this.saveUndo()},selectMusicListHide:function(t){let e=this;if(!1===t){document.querySelectorAll(".ActionPropGroup .selectMusicList audio").forEach((function(t){t.pause(),e.tryListenListIsPlaying=!1})),this.playAudioMusicList.forEach((function(t){t.isTryListen=!1}))}},selectMusicListChange:function(t,e){e.playAudio.specifyAudioList=[],this.playAudioMusicList.forEach((function(i){i.id===t&&e.playAudio.specifyAudioList.push(i)}))},listenPlayAudioList:function(t,e){let i=`#playAudioListTryListen${e.id}`,s=document.querySelector(i),a=this.$t("playAudio2022_07_16.text2");this.tryListenListIsPlaying?(s.pause(),e.isTryListen=!1,this.tryListenListIsPlaying=!1):s&&(e.isTryListen=!0,s.play().catch((t=>{this.$message({type:"info",message:a})})),this.tryListenListIsPlaying=!0)},setPlayAudioTryListenSrc:function(t,e){if(t.musicList.length<1)return"";if(1===t.musicList.length)return t.musicList[0].url;{let e=[];return t.musicList.forEach((function(t){let i=t.url;e.push(i)})),this.$nextTick((function(){let i=`#playAudioListTryListen${t.id}`,s=document.querySelector(i),a=0;s.addEventListener("ended",(function(){a++,a>0&&(s.src=e[a],s.play())}))})),e[0]}},getMusicList:function(){if("pluginMusic"!==this.currentSelectedItem.type)return;let t,e,i=this;if(this.playAudioMusicList=[],this.currentPageItems.forEach((function(s){if(void 0===s.musicList||0===s.musicList.length)return;let a={id:s.id,musicList:s.musicList,isTryListen:!1,isSelect:!1};i.playAudioMusicList.push(a),e=i.playAudioMusicList.find((function(e,s){if(e.id===i.currentSelectedItem.id)return t=s,e}))})),this.playAudioMusicList.length>0){let e=this.playAudioMusicList.splice(t,1);this.playAudioMusicList.push(e[0])}}}},r=(0,i(1001).Z)(c,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"PlayAudio group"},[e("div",{staticClass:"action-group item-group playAudio"},[e("div",{staticClass:"audio_box"},[e("el-select",{attrs:{"data-v":"v2","popper-class":"props-select-input-popper"},on:{change:function(e){return t.audioTypeChange(e,t.currentActionListIndex)}},nativeOn:{mousedown:function(e){return t.saveBeforePage.apply(null,arguments)}},model:{value:t.currentActionListItem.playAudio.audioType,callback:function(e){t.$set(t.currentActionListItem.playAudio,"audioType",e)},expression:"currentActionListItem.playAudio.audioType"}},[t._l(t.selectOptions,(function(i){return[i.isShow?e("el-option",{key:i.value,attrs:{value:i.value,label:t.$t(i.label)}}):t._e()]}))],2),1===t.currentActionListItem.playAudio.audioType?e("div",[e("audio",{ref:"playAudioDemo",staticClass:"play-audio-demo",attrs:{src:t.tryListenPlayAudioSrc}}),e("el-upload",{ref:"playAudioUpload",staticClass:"playAudio-upload props_el-upload-width100",attrs:{action:t.uploadInterface,"show-file-list":!1,data:t.playAudioUploadData,"on-success":(e,i,s)=>t.playAudioUploadSuccess(e,i,s,t.currentActionListIndex),"on-error":(e,i,s)=>t.playAudioUploadError(e,i,s,t.currentActionListIndex),"on-progress":(e,i,s)=>t.playAudioProgress(e,i,s,t.currentActionListIndex),"before-upload":e=>t.addNewPlayAudio(e,t.currentActionListIndex),accept:t.acceptAudioTypeStr,multiple:!1,disabled:t.isUploading}},[e("button",{staticClass:"btn btn-white upload-button",class:{disabled:t.isUploading}},[t._v(" "+t._s(t.$t("PropsForPluginMusic_vue.text3"))+" ")])]),e("div",{staticClass:"upload-file-list",class:{emptyUploadFileList:0===t.currentActionListItem.playAudio.audioList.length}},[0===t.currentActionListItem.playAudio.audioList.length?e("el-row",{staticClass:"emptyMusicList",attrs:{type:"flex",align:"middle",justify:"center"}},[e("el-icon",[e("NoAudioIcon",{tag:"component"})],1),e("span",[t._v(t._s(t.$t("PropsPanle_new.music.NoAudio")))])],1):t._l(t.currentActionListItem.playAudio.audioList,(function(i,s){return e("el-row",{key:s,staticClass:"upload-file-list-row",attrs:{type:"flex",justify:"center",align:"middle"}},[e("el-tooltip",{attrs:{content:t.$t("PropsForPluginMusic_vue.text4"),enterable:!1,"open-delay":800}},["success"===i.uploadStatus&&t.tryListenPlayAudioIndex!==s?e("span",{staticClass:"listenIcon",on:{click:function(e){return t.listenPlayAudio(i,s)}}},[e("el-icon",[e("PlayIcon",{tag:"component"})],1)],1):t._e()]),"success"===i.uploadStatus&&t.tryListenPlayAudioIndex===s?e("span",{staticClass:"listenIcon",on:{click:function(e){return t.listenPlayAudio(i,s)}}},[e("el-icon",[e("PauseIcon",{tag:"component"})],1)],1):t._e(),"success"!==i.uploadStatus?e("span",{staticClass:"listenIcon loadingBox"}):t._e(),e("span",{staticClass:"play-audio-name",attrs:{title:i.name}},[t._v(" "+t._s(i.name)+" ")]),e("div",{staticClass:"musicControl"},[e("el-tooltip",{attrs:{content:t.$t("Properites_vue.text9"),enterable:!1,"open-delay":800}},["success"===i.uploadStatus?e("span",{staticClass:"listenIcon",on:{click:function(e){return t.editPlayAudioItem(t.currentActionListIndex,i,s,"delete")}}},[e("el-icon",[e("CloseIcon",{tag:"component"})],1)],1):t._e()]),e("el-tooltip",{attrs:{content:t.$t("Properites_vue.text9"),enterable:!1,"open-delay":800}},["error"===i.uploadStatus?e("span",{staticClass:"listenIcon",on:{click:function(e){return t.editPlayAudioItem(t.currentActionListIndex,i,s,"delete")}}},[e("el-icon",[e("CloseIcon",{tag:"component"})],1)],1):t._e()]),e("el-tooltip",{attrs:{content:t.$t("ImageWall_vue.text2"),enterable:!1,"open-delay":800}},["uploading"===i.uploadStatus?e("span",{staticClass:"listenIcon",on:{click:function(e){return t.editPlayAudioItem(t.currentActionListIndex,i,s,"cancelImport")}}},[e("el-icon",[e("CloseIcon",{tag:"component"})],1)],1):t._e()])],1)],1)}))],2)],1):t._e(),0===t.currentActionListItem.playAudio.audioType?e("el-input",{staticClass:"props_el-input-h34",attrs:{placeholder:"url"},on:{change:t.saveUpadte},nativeOn:{mousedown:function(e){return t.saveBeforePage.apply(null,arguments)}},model:{value:t.currentActionListItem.playAudio.link,callback:function(e){t.$set(t.currentActionListItem.playAudio,"link",e)},expression:"currentActionListItem.playAudio.link"}}):t._e(),2===t.currentActionListItem.playAudio.audioType?e("el-select",{ref:"selectMusicList",staticClass:"selectMusicList",attrs:{"data-v":"v2","popper-class":"props-select-input-popper","popper-append-to-body":!1,placeholder:t.$t("rightPanel2022_07_12.text10"),"no-data-text":t.$t("rightPanel2022_07_12.text11"),title:t.getLabelName(t.currentActionListItem.playAudio?.specifyAudioList[0])},on:{"visible-change":t.selectMusicListHide,change:function(e){return t.selectMusicListChange(e,t.currentActionListItem)}},model:{value:t.currentActionListItem.playAudio.selectSpecifyAudioListId,callback:function(e){t.$set(t.currentActionListItem.playAudio,"selectSpecifyAudioListId",e)},expression:"currentActionListItem.playAudio.selectSpecifyAudioListId"}},t._l(t.playAudioMusicList,(function(i){return e("el-option",{key:i.id,attrs:{value:i.id,label:t.getLabelName(i),title:""}},[e("div",{staticClass:"selectMusicList-option"},[e("span",{staticClass:"select-option-name",domProps:{innerHTML:t._s(t.showItemName(i))}}),e("span",{staticClass:"icon",class:{play:!i.isTryListen,pause:i.isTryListen},on:{click:function(e){return e.stopPropagation(),t.listenPlayAudioList(e,i)}}}),e("audio",{attrs:{src:t.setPlayAudioTryListenSrc(i,t.currentActionListItem),id:`playAudioListTryListen${i.id}`}})])])})),1):t._e()],1),e("div",{staticClass:"border-top-line"}),e("div",{staticClass:"play-audio-checkbox",attrs:{title:t.$t("pauseOtherMusicWhilePlaying.text1")}},[e("el-checkbox",{attrs:{"data-v":"v2"},on:{change:t.saveUndo},nativeOn:{mousedown:function(e){return t.saveBeforePage.apply(null,arguments)}},model:{value:t.currentActionListItem.playAudio.isPauseBgSoundWhenPlay,callback:function(e){t.$set(t.currentActionListItem.playAudio,"isPauseBgSoundWhenPlay",e)},expression:"currentActionListItem.playAudio.isPauseBgSoundWhenPlay"}},[t._v(t._s(t.$t("pauseOtherMusicWhilePlaying.text1"))+" ")])],1),e("div",{staticClass:"play-audio-checkbox",attrs:{title:t.$t("playAudio2022_08_22.text1")}},[e("el-checkbox",{attrs:{"data-v":"v2"},on:{change:t.saveUndo},nativeOn:{mousedown:function(e){return t.saveBeforePage.apply(null,arguments)}},model:{value:t.currentActionListItem.playAudio.rotateWhenPlay,callback:function(e){t.$set(t.currentActionListItem.playAudio,"rotateWhenPlay",e)},expression:"currentActionListItem.playAudio.rotateWhenPlay"}},[t._v(t._s(t.$t("playAudio2022_08_22.text1"))+" ")])],1),e("div",{staticClass:"border-top-line"}),e("div",{staticClass:"stop-setting"},[e("el-radio-group",{on:{change:t.saveUndo},nativeOn:{mousedown:function(e){return t.saveBeforePage.apply(null,arguments)}},model:{value:t.currentActionListItem.playAudio.pauseOrStopOnReClick,callback:function(e){t.$set(t.currentActionListItem.playAudio,"pauseOrStopOnReClick",e)},expression:"currentActionListItem.playAudio.pauseOrStopOnReClick"}},[e("el-radio",{attrs:{"data-v":"v2",label:0,title:t.$t("playAudio.pauseWhenReClick")}},[e("span",{staticClass:"radio-text"},[t._v(t._s(t.$t("playAudio.pauseWhenReClick")))])]),e("el-radio",{attrs:{"data-v":"v2",label:1,title:t.$t("playAudio.stopWhenReClick")}},[e("span",{staticClass:"radio-text"},[t._v(" "+t._s(t.$t("playAudio.stopWhenReClick")))])])],1)],1)])])}),[],!1,null,"af5d7c1a",null),d=r.exports},22582:function(t,e,i){i.d(e,{b:function(){return s}});i(11721);function s(){return"#0099ff"}}}]);