"use strict";(self.webpackChunkeditor_cli=self.webpackChunkeditor_cli||[]).push([[81],{30081:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});i(57658);var o=i(25986),s=i(24118),n=i(69773),r=i(11201),a=i(89951),l=i(88661),c=i(18023),h=i(99519),p=i(58866),u={name:"SecondMenuForHotZone",data(){return{isHasHomePage:!1,hotUrl:"",isChanging:!1,curPercent:0,msg:"",isShowImportAlert:!1,isStopImportAlert:!1,processTimer:null,taskId:"",bookPages:"",timerNum:0,defaultLinkOpacity:0}},computed:{isYZPro:function(){return this.$store.getters.isYZPro},pages:function(){return this.$store.state.pagePanel.pages},bookId:function(){return this.$store.state.bookData.bookId},originalWidth:function(){return this.$store.state.workSpace.canvas.page.originalWidth},originalHeight:function(){return this.$store.state.workSpace.canvas.page.originalHeight},selectMultiList:function(){return this.$store.state.pagePanel.selectMultiList}},watch:{taskId:function(){""!==this.taskId&&(this.clearProcessTimer(),this.getProcess())}},methods:{setPagesLinkData:function(t){for(let e=0;e<t.length;e++){let i=this.pages[e];if(i&&t[e]&&t[e].data&&t[e].data.length){-1===this.selectMultiList.indexOf(e)&&(this.$store.commit(c.XnR,{index:e}),this.$store.commit(c.fu1,{item:{item:s.Z.copy(i,!0),pageIndex:e}}));const{pageIsFreezed:o,pageToUnfreeze:n,pageToFreeze:r}=(0,l.qt)(),h=o(i);h&&n(i),t[e].data.forEach(((t,e)=>{if(t&&Object.keys(t).length){const e={actionList:[this.getActionLink(t)],style:this.getLinkSizeConfig(t)};i.items.push(new a.nf(e))}})),h&&r(i)}}this.$store.commit(c.N23,{action:"applyToAll",canUndo:!0})},getLinkSizeConfig:function(t){if(t&&t.range&&t.range.length){let e={x:t.range[0],y:t.range[1]},i={x:t.range[4],y:t.range[5]};return t.range[4]<t.range[0]&&(e.x=t.range[4],i.x=t.range[0]),t.range[5]<t.range[1]&&(e.y=t.range[5],i.y=t.range[1]),{opacity:isNaN(this.defaultLinkOpacity)?0:this.defaultLinkOpacity,left:e.x*this.originalWidth+"px",top:e.y*this.originalHeight+"px",width:i.x-e.x,height:i.y-e.y}}},getActionLink:function(t){let e=["https://",t.link];return t.link.indexOf("://")>-1&&(e=t.link.split("://")),n.Z.getDefaultItemAction({linkList:{type:"link",url:e[1],urlHead:e[0]+"://"}})},getProcess:function(){this.taskId&&this.$http.post(`${this.$store.getters.host}/api/book/get-book-progress`,{taskId:this.taskId}).then((t=>{t.data.code+""=="OK"?-1===t.data.bookStatus?(this.curPercent=100,this.isChanging=!1,this.clearProcessTimer(),this.msg=this.$message({showClose:!0,message:t.data.msg,type:"error",duration:3e3})):1===t.data.bookStatus&&1===t.data.convertStatus?(this.curPercent=100,this.isChanging=!1,this.clearProcessTimer(),this.msg=this.$message({showClose:!0,message:"转换完毕",type:"success",duration:3e3}),this.setPagesLinkData(t.data.link_data)):(this.curPercent=t.data.convertProgress,this.processTimer=setTimeout((()=>{this.timerNum+=1,this.getProcess()}),1500)):(this.curPercent=100,this.isChanging=!1,this.clearProcessTimer(),this.msg=this.$message({showClose:!0,message:t.data.msg,type:"error",duration:3e3}))}))},clearProcessTimer:function(){this.processTimer&&(clearTimeout(this.processTimer),this.processTimer=null)},importeHotZoneUrl:function(){this.isChanging=!0,this.isShowImportAlert=!1;let t=this.isHasHomePage?0:1;this.$http.post(`${this.$store.getters.host}/api/book/editor/create-hot-import`,{bookCover:t,link:this.hotUrl,bookId:this.bookId}).then((t=>{t.data.code+""=="OK"&&(this.taskId=t.data.data.taskId)}))},cancelImportUrl:function(){this.isStopImportAlert=!0},stopImportUrl:function(){this.isChanging=!1,this.isStopImportAlert=!1,this.clearProcessTimer(),this.curPercent=0,this.taskId=""},checkActionListNoEmpty:function(){let t=!1;for(let e=0;e<this.pages.length;e++)for(let i=0;i<this.pages[e].items.length;i++){let o=this.pages[e].items[i].actionList;for(let e=0;e<o.length;e++){let i=o[e];if(s.Z.checkIsHasAction(i))return t=!0,t}}return t},clearPageItemsAndImport:function(){for(let t=0;t<this.pages.length;t++)this.pages[t].items=[];this.importeHotZoneUrl()},checkHotZoneConfig:function(){if(""===this.hotUrl.trim())return this.msg&&this.msg.close(),void(this.msg=this.$message({showClose:!0,message:this.$i18n.t("SecondMenuForHotZone.import_msg1"),type:"warning",duration:3e3}));if(this.hotUrl){this.checkActionListNoEmpty()?this.isShowImportAlert=!0:this.importeHotZoneUrl()}},close(){this.$store.commit(c.$8l,{menu:"scene"})}},components:{EditorSecondMenu:h.Z,PropGroup:r.default,Lightbox:o.default,LinkItem:a.nf,EditorSecondMenuTitle:p.Z,PropsSlider:()=>i.e(9428).then(i.bind(i,19428))}},d=(0,i(1001).Z)(u,(function(){var t=this,e=t._self._c;return e("EditorSecondMenu",[e("el-row",{staticClass:"SecondMenuForHotZone"},[e("el-row",{staticClass:"hotzone_top"},[e("EditorSecondMenuTitle",{attrs:{title:t.$t("SecondMenuForHotZone.hotZone_Title")},on:{"close-panel":t.close}})],1),e("PropGroup",[e("el-row",{staticStyle:{gap:"10px"},attrs:{type:"flex",align:"middle"}},[e("div",{staticClass:"input_box"},[e("el-input",{staticClass:"props_el-input-h34",attrs:{placeholder:"url"},model:{value:t.hotUrl,callback:function(e){t.hotUrl=e},expression:"hotUrl"}})],1),e("div",{staticClass:"editor_v2_main_btn",class:{disabled:!t.hotUrl},on:{click:function(e){return e.stopPropagation(),t.checkHotZoneConfig.apply(null,arguments)}}},[t._v(" "+t._s(t.isChanging?"导入中...":"导入")+" ")])]),e("el-checkbox",{attrs:{"data-v":"v2",disabled:t.isChanging},model:{value:t.isHasHomePage,callback:function(e){t.isHasHomePage=e},expression:"isHasHomePage"}},[e("span",{directives:[{name:"t",rawName:"v-t",value:"SecondMenuForHotZone.home_page",expression:"'SecondMenuForHotZone.home_page'"}]})])],1),e("PropGroup",[e("PropsSlider",{attrs:{sliderNumber:t.defaultLinkOpacity,title:t.$t("SecondMenuForHotZone.import_link_opacity"),step:.1,disabled:t.isChanging,min:0,max:1},on:{"update:sliderNumber":function(e){t.defaultLinkOpacity=e},"update:slider-number":function(e){t.defaultLinkOpacity=e}}})],1),e("div",{staticClass:"tips"},[t._v(" 目前支持的报纸有《经济日报》《国家电网报》 《赣南日报》《深圳特区报》等，如若还没有支持您的期刊，请联系我们的客服咨询支持。 ")])],1),t.isShowImportAlert?e("Lightbox",{attrs:{isShow:t.isShowImportAlert,showAlert:!0,isAutoWidth:!0,title:"提示",confirmBtnTxt:"取消"},on:{"update:isShow":function(e){t.isShowImportAlert=e},"update:is-show":function(e){t.isShowImportAlert=e}}},[e("div",{staticClass:"alert-content"},[e("span",{directives:[{name:"t",rawName:"v-t",value:"SecondMenuForHotZone.import_alert2",expression:"'SecondMenuForHotZone.import_alert2'"}]}),e("el-row",{staticClass:"button-groups",attrs:{type:"flex",align:"middle"}},[e("div",{directives:[{name:"t",rawName:"v-t",value:"SecondMenuForHotZone.clear_all_and_import",expression:"'SecondMenuForHotZone.clear_all_and_import'"}],staticClass:"editor_v2_main_btn",on:{click:function(e){return e.stopPropagation(),t.clearPageItemsAndImport.apply(null,arguments)}}}),e("div",{directives:[{name:"t",rawName:"v-t",value:"SecondMenuForHotZone.keep_and_import",expression:"'SecondMenuForHotZone.keep_and_import'"}],staticClass:"editor_v2_main_btn",on:{click:function(e){return e.stopPropagation(),t.importeHotZoneUrl.apply(null,arguments)}}})])],1)]):t._e(),t.isStopImportAlert?e("Lightbox",{attrs:{isShow:t.isStopImportAlert,showAlert:!0,isAutoWidth:!0,title:"提示",confirmCallBack:t.stopImportUrl},on:{"update:isShow":function(e){t.isStopImportAlert=e},"update:is-show":function(e){t.isStopImportAlert=e}}},[e("div",{directives:[{name:"t",rawName:"v-t",value:"SecondMenuForHotZone.import_alert3",expression:"'SecondMenuForHotZone.import_alert3'"}],staticClass:"alert-content"})]):t._e()],1)}),[],!1,null,"c3f1f54c",null),m=d.exports}}]);