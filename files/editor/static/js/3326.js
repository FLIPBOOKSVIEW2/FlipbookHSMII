"use strict";(self.webpackChunkeditor_cli=self.webpackChunkeditor_cli||[]).push([[3326],{73326:function(t,e,a){a.r(e),a.d(e,{useCapture:function(){return b}});a(21703);var n=a(48180),i=a(37250),r=a(88661),s=a(18023),o=a(75151),h=a(47774),u=a(55011),c={name:"CapturePageInner",props:{page:{type:r.X0},pageIndex:{type:Number},thumbWidth:{type:Number},thumbHeight:{type:Number},quality:{type:Number,default:.8},onError:{type:Function},onSuccess:{type:Function}},data(){return{}},computed:{pageStyle:function(){return this.$store.state.workSpace.canvas.page},originPageWidth:function(){return this.pageStyle.originalWidth},originPageHeight:function(){return this.pageStyle.originalHeight},trueMainWidth:function(){return i.kf},thumbStyle(){const t=this.originPageWidth/this.originPageHeight;return this.thumbWidth&&this.thumbHeight?{width:this.thumbWidth+"px",height:this.thumbHeight+"px"}:{width:this.trueMainWidth+"px",height:this.trueMainWidth/t+"px"}}},mounted(){this.$store.state.topHeader.captureStatus=!0},methods:{async startCapture(){if(this.page.backgroundImage.indexOf(".zip")>1){const t=this.page.pageId,e=function(e){const a=document.getElementById(`page_canvas_${t}`);a&&a.appendChild(e),h.v.addHandle()},a=(0,h.p)(e,{canvasImg:this.page.backgroundImage,containerStyle:{width:parseFloat(this.thumbStyle.width),height:parseFloat(this.thumbStyle.height)}});await a.start().then((()=>{})).catch((t=>{}))}await this.$store.dispatch(s.nRN,{targetPage:this.page});const t=this.$refs.captureDom;if(!t)throw Error("no find capture dom");return await(0,u._)(1e3),o.Z.toJpeg(t,{quality:this.quality,width:parseFloat(this.thumbStyle.width),height:parseFloat(this.thumbStyle.height),style:{transformOrigin:"left top"},bgcolor:"rgb(255,255,255)"}).then((t=>t)).catch((t=>{throw Error(t)}))}},components:{WorkSpacePageInner:n.Z}},p=(0,a(1001).Z)(c,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"hiddenPageDom"},[e("div",{ref:"captureDom",staticClass:"singlePage captureCon",style:t.thumbStyle,attrs:{id:"captureDom"}},[e("div",{ref:"canvasDom",staticClass:"page_canvas_container",style:t.thumbStyle,attrs:{id:`page_canvas_${t.page.pageId}`}}),e("WorkSpacePageInner",{staticClass:"thumbRender",attrs:{page:t.page,render:!0,thumbRender:!0,captureMode:!0,thumbWidth:t.thumbWidth,thumbHeight:t.thumbHeight,captureRenderStyle:t.thumbStyle}})],1)])}),[],!1,null,"2445eed2",null).exports,g=a(64001),d=a(97873);class l{constructor(t){(0,d.Z)(this,"page",null),(0,d.Z)(this,"pageIndex",-1),(0,d.Z)(this,"onError",(function(){})),(0,d.Z)(this,"onSuccess",(function(){})),t.page&&(this.page=t.page),t.onError&&(this.onError=t.onError),t.onSuccess&&(this.onSuccess=t.onSuccess),t.pageIndex&&(this.pageIndex=t.pageIndex)}}var m=a(11721);const b=function(t){if(!t.page)throw Error("missing parameter");const e=Object.assign({},new l({}),t||{}),a=new(g.default.extend(p))({propsData:{page:e.page,pageIndex:e.pageIndex,onError:function(t){throw Error(t)},onSuccess:e.onSuccess,thumbWidth:e.thumbWidth,thumbHeight:e.thumbHeight,quality:e.quality,closePanel:function(){i()}},store:m.Z});a.$mount();const n=a.$mount().$el;document.body.appendChild(n);const i=()=>{document.body.contains(n)&&(a.$destroy(),document.body.removeChild(n))};return{close:function(){i()},getImage:function(){return a.startCapture?a.startCapture():Promise.reject("no capture instance")}}}}}]);