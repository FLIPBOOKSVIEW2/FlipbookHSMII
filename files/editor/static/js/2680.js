"use strict";(self.webpackChunkeditor_cli=self.webpackChunkeditor_cli||[]).push([[2680],{52680:function(t,e,i){i.r(e),i.d(e,{default:function(){return P}});i(57658);var s=i(18023),a=i(1585),n=i(24118),o=i(2137),l=i(30874),r={name:"UserFileSelect",data(){return{fileSystem:{open:function(){},reset:function(){}}}},props:{uploadText:{type:String,default:"上传文件",desc:"上传按钮显示的文本"},fileDialogOpts:{type:o.C,default:function(){return new o.C},desc:"文件上传配置"},disable:{type:Boolean,default:!1,desc:"是否可以使用上传按钮"},dataFnSearch:{type:String,default:"",desc:"功能查找用于辨识的自定义data"}},mounted(){this.fileSystem=(0,o.v)(this.fileDialogOpts,this.fileSelect)},methods:{selectFile(){this.disable?this.$emit("upload-limit"):(this.$emit("file-dialog-open"),this.fileSystem.open())},fileSelect(t){this.$emit("upload-file-select",t)}},components:{IconUpload:l.Z}},p=i(1001),c=(0,p.Z)(r,(function(){var t=this,e=t._self._c;return e("el-row",{staticStyle:{width:"100%"},attrs:{"data-fn-search":t.dataFnSearch},nativeOn:{click:function(e){return t.selectFile.apply(null,arguments)}}},[t._t("default",(function(){return[e("el-row",{staticClass:"editor_v2_main_btn upload_button",attrs:{type:"flex",align:"middle",justify:"center"}},[e("el-icon",{attrs:{size:14}},[e("IconUpload")],1),e("span",[t._v(" "+t._s(t.uploadText)+" ")])],1)]}))],2)}),[],!1,null,"1abe9f76",null),u=c.exports,d=(0,p.Z)({},(function(){var t=this._self._c;return t("svg",{attrs:{idth:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9 2L1 16H17L9 2Z",fill:"#F24F21",stroke:"#F24F21","stroke-width":"1.83333","stroke-linejoin":"round"}}),t("path",{attrs:{d:"M9 13.125V13.5",stroke:"white","stroke-width":"1.83333","stroke-linecap":"round"}}),t("path",{attrs:{d:"M9 7.125L9.00311 10.8748",stroke:"white","stroke-width":"1.83333","stroke-linecap":"round"}})])}),[],!1,null,null,null).exports,m=(0,p.Z)({},(function(){var t=this._self._c;return t("svg",{attrs:{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9 2L1 16H17L9 2Z",fill:"#FFA53A",stroke:"#FFA53A","stroke-width":"1.83333","stroke-linejoin":"round"}}),t("path",{attrs:{d:"M9 13.125V13.5",stroke:"white","stroke-width":"1.83333","stroke-linecap":"round"}}),t("path",{attrs:{d:"M9 7.125L9.00311 10.8748",stroke:"white","stroke-width":"1.83333","stroke-linecap":"round"}})])}),[],!1,null,null,null).exports,g=(0,p.Z)({},(function(){var t=this._self._c;return t("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("g",{attrs:{"clip-path":"url(#clip0_2502_2754)"}},[t("circle",{attrs:{cx:"8",cy:"8",r:"8",fill:"#38B865"}}),t("path",{attrs:{d:"M4.5 8.5L7.2 11L12 6",stroke:"white","stroke-width":"1.83","stroke-linecap":"round","stroke-linejoin":"round"}})]),t("defs",[t("clipPath",{attrs:{id:"clip0_2502_2754"}},[t("rect",{attrs:{width:"16",height:"16",fill:"white"}})])])])}),[],!1,null,null,null).exports,h=(0,p.Z)({},(function(){var t=this._self._c;return t("svg",{attrs:{width:"1em",viewBox:"0 0 8 5",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M0 4.42305V4.49578C0 4.77425 0.225747 5 0.504221 5C0.646282 5 0.781753 4.94007 0.877314 4.83496L3.39176 2.06907C3.54755 1.8977 3.7684 1.8 4 1.8C4.2316 1.8 4.45245 1.8977 4.60824 2.06907L7.12269 4.83495C7.21825 4.94007 7.35372 5 7.49578 5C7.77425 5 8 4.77425 8 4.49578V4.42305C8 4.27953 7.9465 4.14115 7.84996 4.03495L4.60824 0.469069C4.45245 0.297699 4.2316 0.2 4 0.2C3.7684 0.2 3.54755 0.2977 3.39176 0.469069L0.150041 4.03495C0.0534956 4.14115 0 4.27953 0 4.42305Z",fill:"#333333"}})])}),[],!1,null,null,null).exports,f=(0,p.Z)({},(function(){var t=this._self._c;return t("svg",{attrs:{height:"1em",viewBox:"0 0 12 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.75 0.65V4.25H0.15L0.45 3.875L3.375 0.875L3.75 0.65ZM5.25 0.5V4.25C5.25 4.64783 5.09196 5.02936 4.81066 5.31066C4.52936 5.59197 4.14782 5.75 3.75 5.75H0V14C0 14.825 0.675 15.5 1.5 15.5H10.5C10.8978 15.5 11.2794 15.342 11.5607 15.0607C11.842 14.7794 12 14.3978 12 14V2C12 1.60218 11.842 1.22064 11.5607 0.93934C11.2794 0.658035 10.8978 0.5 10.5 0.5H5.25ZM7.5 2H9V3.5H7.5V5H9V6.5H7.5V8.00001H9V9.50001H7.5V11H9V12.5H7.5V14H6V12.5H7.5V11H6V9.50001H7.5V8.00001H6V6.5H7.5V5H6V3.5H7.5V2Z",fill:"currentColor"}})])}),[],!1,null,null,null).exports,I=i(25986),v=(0,p.Z)({},(function(){var t=this._self._c;return t("svg",{attrs:{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13 2H3C2.44772 2 2 2.44772 2 3V13C2 13.5523 2.44772 14 3 14H13C13.5523 14 14 13.5523 14 13V3C14 2.44772 13.5523 2 13 2ZM3 0C1.34315 0 0 1.34315 0 3V13C0 14.6569 1.34315 16 3 16H13C14.6569 16 16 14.6569 16 13V3C16 1.34315 14.6569 0 13 0H3Z",fill:"currentColor"}}),t("path",{attrs:{d:"M4 5.5C4 4.67157 4.67157 4 5.5 4C6.32843 4 7 4.67157 7 5.5C7 6.32843 6.32843 7 5.5 7C4.67157 7 4 6.32843 4 5.5Z",fill:"currentColor"}}),t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.2601 10.1733C12.5927 8.33919 9.36603 8.9099 8.1952 11.3513C7.65632 12.4749 7.05749 13.5649 6.43599 14.3886C6.1258 14.7996 5.78336 15.1803 5.41008 15.4664C5.04324 15.7476 4.56324 16.0006 4 16.0006C3.44772 16.0006 3 15.5529 3 15.0006C3 14.4527 3.4407 14.0076 3.98699 14.0007C4.00021 13.997 4.06679 13.9761 4.19341 13.8791C4.36936 13.7442 4.58756 13.5177 4.83953 13.1838C5.34232 12.5176 5.87378 11.5667 6.39186 10.4864C8.07591 6.97491 12.9663 5.77688 15.7399 8.82793C16.1114 9.23659 16.0813 9.86903 15.6727 10.2405C15.264 10.612 14.6316 10.5819 14.2601 10.1733Z",fill:"currentColor"}})])}),[],!1,null,null,null).exports,C={props:{CompressorFactory:{type:Object,default:()=>{}},tipsSize:{type:Number,default:1920},hasSizeTips:{type:Boolean,default:!0}},data(){return{show:!0,fold:[],uploadLumpList:[],isCompressing:!1,isQueueCompressor:!1}},computed:{isSelectAll(){return 0===this.taskList.filter((t=>{const e=t.file.failType;return"string"!=typeof e&&0!==e.length})).filter((t=>!t.checked)).length},disabledCompress(){return 0===this.taskList.filter((t=>{const e=t.file.failType;return"string"!=typeof e&&0!==e.length})).filter((t=>t.checked)).length},taskList(){return this.CompressorFactory.taskList??[]},imageLimit(){return this.$store.getters.imageLimit},notCompress(){const t=this.uploadLumpList.find((t=>"OverSize"===t.type)),e=this.uploadLumpList.find((t=>"OverLongestSize"===t.type)),i=[];return t&&i.push(...t.taskList),e&&i.push(...e.taskList),0===i.length},criterionList(){const t=this.uploadLumpList.find((t=>"criterion"===t.type)),e=this.uploadLumpList.find((t=>"OverLongestSize"===t.type)),i=[];return t&&i.push(...t.taskList),e&&i.push(...e.taskList),i},hasFailTask(){return 0!==this.taskList.filter((t=>"fail"===t.taskStatus)).length},maxSvgSize(){return this.$store.state.upgradePanel.serviceLimit.lottieLimit.maxSize},maxGifSize(){return this.$store.state.upgradePanel.serviceLimit.imageLimit.maxSize}},mounted(){this.initUploadLumList()},methods:{initUploadLumList(){const t=[{tips:this.$t(this.hasSizeTips?"UpLoadPanel_vue.MutliuploadImage.OverSize":"UpLoadPanel_vue.MutliuploadImage.OverSizeTips",{size:this.imageLimit.maxSize/1024/1024,pixel:`${this.tipsSize}px*${this.tipsSize}px`}),tipsType:"Error",type:"OverSize",taskList:this.taskList.filter((t=>{const e=t.file.failType,i="string"!=typeof e&&(e.includes("image_over_size")||e.includes("over_longest_side_size"));return i&&this.$set(t,"checked",!0),i}))},{tips:this.$t("UpLoadPanel_vue.MutliuploadImage.CannotUpload"),tipsType:"Error",type:"CannotUpload",taskList:this.taskList.filter((t=>"string"==typeof t.file.failType))},{tips:this.$t("UpLoadPanel_vue.MutliuploadImage.OverLongestSize"),tipsType:"Warning",type:"OverLongestSize",taskList:this.hasSizeTips?this.taskList.filter((t=>{const e=t.file.failType;return"string"!=typeof e&&e.includes("over_longest_size")&&1===e.length})):[]},{tips:this.$t("UpLoadPanel_vue.MutliuploadImage.criterion",{size:this.imageLimit.maxSize/1024/1024,pixel:`${this.tipsSize}px*${this.tipsSize}px`}),tipsType:"Success",type:"criterion",taskList:this.hasSizeTips?this.taskList.filter((t=>{const e=t.file.failType;return"string"!=typeof e&&0===e.length})):this.taskList.filter((t=>{const e=t.file.failType;return"string"!=typeof e&&(0===e.length||e.includes("over_longest_size")&&1===e.length)}))}];this.uploadLumpList=t.filter((t=>t.taskList.length>0))},computeGradient(t){return"isCompressing"!==t.taskStatus?{backgroundColor:"#f2f3f5"}:{background:`linear-gradient(to right, #E0F1FF ${t.compressorProgress}%, #f2f3f5 ${t.compressorProgress}%, #f2f3f5 100%`}},changeFold(t){if(this.fold.includes(t)){const e=this.fold.findIndex((e=>e===t));this.fold.splice(e,1)}else this.fold.push(t)},selectAll(t){this.taskList.forEach((e=>{const i=e.file.failType;"string"!=typeof i&&0!==i.length&&this.$set(e,"checked",t)}))},close(){this.$emit("close"),this.CompressorFactory.clearTask()},cancel(){this.close()},confirmUpload(){this.$emit("upload-image",this.criterionList.map((t=>t.file))),this.close()},async startCompress(){if(this.disabledCompress)return;this.isCompressing=!0,this.isQueueCompressor=!0;const t=this.taskList.filter((t=>t.checked));await this.CompressorFactory.queueCompressor(t),this.isCompressing=!1},uploadCompressorImage(){if(this.isCompressing)return;let t=this.taskList.filter((t=>{const e=t.file.failType;return"string"!=typeof e&&!e.includes("image_over_size")}));this.$emit("upload-image",t.map((t=>t.file))),this.close()},async againCompress(){if(this.isCompressing)return;this.isCompressing=!0;const t=this.taskList.filter((t=>{const e=t.file.failType;return t.checked&&"string"!=typeof e&&0!==e.length}));await this.CompressorFactory.queueCompressor(t),this.isCompressing=!1}},components:{ErrorIcon:d,WarningIcon:m,SuccessIcon:g,ArrowIcon:h,Lightbox:I.default,FileIcon:f,ImageIcon:v}},L=(0,p.Z)(C,(function(){var t=this,e=t._self._c;return t.show?e("Lightbox",{attrs:{isShow:t.show,closeCallBack:t.close,forbidClickBg:!0,title:t.$t("UpLoadPanel_vue.MutliuploadImage.Title"),customWidth:780},on:{"update:isShow":function(e){t.show=e},"update:is-show":function(e){t.show=e}}},[e("div",{staticClass:"MultiUploadImage"},[e("div",{staticClass:"compress_main scrollbar-container"},t._l(t.uploadLumpList,(function(i,s){return e("div",{key:s,staticClass:"compress_type_block"},[e("div",{staticClass:"header",class:i.tipsType},[e("el-row",{staticClass:"items-center gap-x-1.5 flex-1",attrs:{type:"flex"}},[e("el-icon",{attrs:{size:18}},[e(i.tipsType+"Icon",{tag:"component"})],1),e("div",{staticClass:"tips flex-1"},[t._v(t._s(i.tips))])],1),e("el-row",{staticClass:"spread items-center justify-center",class:{fold:t.fold.includes(i.type)},attrs:{type:"flex"},nativeOn:{click:function(e){return t.changeFold(i.type)}}},[e("el-icon",{attrs:{size:9}},[e("ArrowIcon",{tag:"component"})],1)],1)],1),t.fold.includes(i.type)?t._e():e("div",t._l(i.taskList,(function(s,a){return e("el-row",{key:a,staticClass:"file_row",style:t.computeGradient(s),attrs:{type:"flex",justify:"space-between",align:"middle"}},[e("el-row",{staticClass:"taskinfo_flex_1",attrs:{type:"flex",align:"middle"}},[["OverSize","OverLongestSize"].includes(i.type)?e("el-checkbox",{attrs:{"data-v":"v2",disabled:t.isQueueCompressor},model:{value:s.checked,callback:function(e){t.$set(s,"checked",e)},expression:"task.checked"}}):t._e(),e("el-row",{staticClass:"task_cover",attrs:{type:"flex",align:"middle",justify:"center"}},[s.file.url?e("img",{attrs:{src:s.file.url}}):e("el-icon",{attrs:{size:16}},[e("ImageIcon",{tag:"component"})],1)],1),e("el-row",{staticClass:"flex-col gap-y-2.5",attrs:{type:"flex"}},[e("div",{staticClass:"text_ellipsis"},[t._v(t._s(s.file.name))]),"isCompressing"!==s.taskStatus?e("el-row",{staticClass:"gap-x-3",attrs:{type:"flex",align:"middle"}},[e("span",[t._v(t._s((s.file.space/1024/1024).toFixed(2))+"MB")]),["svg","json"].includes(s.file.resourceSuffix)?t._e():e("span",[t._v(t._s(s.file.width)+"*"+t._s(s.file.height)+"px")]),"CannotUpload"===i.type&&["svg","json","gif"].includes(s.file.resourceSuffix)?e("span",{staticClass:"fail_tips"},[t._v(t._s(t.$t("UpLoadPanel_vue.MutliuploadImage.OverCannotUpload",{size:"gif"===s.file.resourceSuffix?`${(t.maxGifSize/1024/1024).toFixed(2)}MB`:`${(t.maxSvgSize/1024).toFixed(2)}KB`})))]):t._e(),"success"===s.taskStatus?[0===s.file.failType.length?e("span",{staticClass:"success_tips"},[t._v(t._s(t.$t("UpLoadPanel_vue.MutliuploadImage.compresssSuccess")))]):e("span",{staticClass:"fail_tips"},[t._v(t._s(t.$t("UpLoadPanel_vue.MutliuploadImage.compresssOverSize")))])]:t._e(),"fail"===s.taskStatus?e("span",{staticClass:"fail_tips"},[t._v(t._s(t.$t("UpLoadPanel_vue.MutliuploadImage.compresssFail")))]):t._e(),["OverSize","OverLongestSize"].includes(i.type)&&!s.checked&&t.isQueueCompressor?e("span",{staticClass:"fail_tips"},[t._v(t._s(t.$t("UpLoadPanel_vue.MutliuploadImage.notCompress")))]):t._e()],2):e("el-row",{staticClass:"gap-x-3",staticStyle:{"line-height":"18px"},attrs:{type:"flex",align:"middle"}},[e("span",[t._v(t._s(t.$t("UpLoadPanel_vue.MutliuploadImage.compresssing")))]),e("span",[t._v(t._s(s.compressorProgress)+"%")])])],1)],1)],1)})),1)])})),0),e("div",{staticClass:"footer"},[t.notCompress?t._e():e("el-row",{staticClass:"gap-x-2 mb-2",attrs:{type:"flex",align:"middle"}},[e("el-checkbox",{attrs:{"data-v":"v2",disabled:t.isQueueCompressor,value:t.isSelectAll},on:{change:t.selectAll}}),t._v(t._s(t.$t("UpLoadPanel_vue.MutliuploadImage.selectAll"))+" ")],1),e("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[e("el-row",{staticClass:"editor_v2_white_btn gap-x-1.5",class:{disabled:t.isCompressing},style:{visibility:t.hasFailTask?"visible":"hidden"},nativeOn:{click:function(e){return t.againCompress.apply(null,arguments)}}},[e("el-icon",{attrs:{size:16}},[e("FileIcon",{tag:"component"})],1),t._v(" "+t._s(t.hasFailTask?t.$t("UpLoadPanel_vue.MutliuploadImage.againCompress"):"")+" ")],1),e("el-row",{staticClass:"gap-x-2.5",attrs:{type:"flex",align:"middle"}},[e("el-row",{staticClass:"editor_v2_white_btn",nativeOn:{click:function(e){return t.cancel.apply(null,arguments)}}},[t._v(t._s(t.$t("capturePanel.manualCancel")))]),t.isQueueCompressor?e("el-row",{staticClass:"editor_v2_main_btn",class:{disabled:t.isCompressing},nativeOn:{click:function(e){return t.uploadCompressorImage.apply(null,arguments)}}},[t._v(t._s(t.$t("UpLoadPanel_vue.MutliuploadImage.upload")))]):[0!==t.criterionList.length?e("el-row",{staticClass:"uploadBtn footerBtn",nativeOn:{click:function(e){return t.confirmUpload.apply(null,arguments)}}},[t._v(t._s(t.$t("UpLoadPanel_vue.MutliuploadImage.criterionUpload")))]):t._e(),t.notCompress?t._e():e("el-row",{staticClass:"editor_v2_main_btn gap-x-1.5",class:{compressDisabled:t.disabledCompress},nativeOn:{click:function(e){return t.startCompress.apply(null,arguments)}}},[e("el-icon",{attrs:{size:16}},[e("FileIcon",{tag:"component"})],1),t._v(" "+t._s(t.$t("UpLoadPanel_vue.MutliuploadImage.compresss")))],1)]],2)],1)],1)])]):t._e()}),[],!1,null,"495f076a",null),_=L.exports,y=i(66517),x=i(28206),w=i(83342),S={name:"PopupImg",components:{MutiUploadList:()=>Promise.resolve().then(i.bind(i,87632)),ArrowTopIcon:()=>i.e(4451).then(i.bind(i,4451)),CloseIcon:()=>i.e(1118).then(i.bind(i,41118)),ArrowDownIcon:()=>i.e(6502).then(i.bind(i,66502)),EditIcon:()=>i.e(8717).then(i.bind(i,18717)),ReplaceIcon:()=>i.e(730).then(i.bind(i,30730)),InfoTipsIcon:()=>i.e(3352).then(i.bind(i,83352)),UserFileSelect:u,MultiUploadImage:_},mixins:[a.Z],data(){return{curPopupImgEditItem:"",imagesList:[],isShowFastAddBtn:!1,curFastAddIndex:"",isEnterPopUpImgEdit:!1,curPopupImgEditIndex:"",curPopupImgEditImgListIndex:"",uploadImageCount:0,isAllUploaded:!1,isStartUpload:!1,originImagesCount:0,imagesCount:0,itemTypeList:["image","svg"],isPopImgLoading:!1,isShowMultUploadImagePanel:!1,CompressorFactory:null,messageHandle:null}},mounted(){const t=this.actionList[this.currentActionListIndex].popupImg.imgList.length;this.uploadImageCount=t,this.showFastAddPopImg(this.currentActionListIndex),this.CompressorFactory=new y.LY({maxSizeMB:this.curUserCanUpladImageSize/1024/1024,maxWidthOrHeight:this.longestSideSize})},beforeDestroy(){this.showFastAddPopImg()},watch:{isStartUpload:function(t){const e=this.actionList[this.currentActionListIndex].popupImg.imgList.length;if(t&&(this.originImagesCount=e),!t){this.imagesCount=e;const t=this.imagesCount-this.originImagesCount;this.sortPopupImgListByName(t)}},isShowCompressLightBox(t){!t&&this.CompressorFactory.taskList[0]&&this.CompressorFactory.clearTask()}},computed:{longestSideSize(){return this.$store.getters.longestSideSize},isShowAddCurrentPopupImg:function(){return this.itemTypeList.includes(this.currentSelectedItemType)},acceptImageType:function(){return this.$store.getters.acceptImageType},currentPopupImg:function(){let t={};return"svg"===this.currentSelectedItemType&&(t.url=this.currentSelectedItem.svgUrl),"image"===this.currentSelectedItemType&&(t.url=this.currentSelectedItem.url),t.fileName=n.Z.getPathFilename(t.url),t},currentSelectedItemType:function(){return this.currentSelectedItem.type},isShowFastAddButton:function(){return!(!this.isShowAddCurrentPopupImg||!this.isShowFastAddBtn)&&this.curFastAddIndex===this.currentActionListIndex},isShowEditPanel:function(){return!!this.isEnterPopUpImgEdit&&this.curPopupImgEditIndex===this.currentActionListIndex},currentImgList:function(){return this.actionList[this.currentActionListIndex].popupImg.imgList},imgCanBeSave:{get(){const t=this.actionList[this.currentActionListIndex].popupImg.imgCanBeSave;return void 0===t||t},set(t){this.actionList[this.currentActionListIndex].popupImg.imgCanBeSave=t}},imgLink:{get(){return(this.curPopupImgEditItem.link||"").replace(/^http[s]*:\/\//,"")},set(t){const e="https://"+t.replace(/^http[s]*:\/\//,"");this.$set(this.curPopupImgEditItem,"link",e)}},isYZPro:function(){return this.$store.getters.isYZPro},imageUploadOpts(){return new o.C({multiple:!1,accept:this.acceptImageType.map((t=>`.${t}`)).join(",")})},imageUploadOptsMulti(){return new o.C({multiple:!0,accept:this.acceptImageType.map((t=>`.${t}`)).join(",")})},curUserCanUpladImageSize(){return this.imageLimit.maxSize},imageLimit(){return this.$store.getters.imageLimit},uploadPanelUploadAcceptArr(){return this.$store.getters.uploadPanelUploadAccept},svgLimit:function(){return this.$store.getters.svgLimit},isShowCompressLightBox:{get:function(){return this.$store.state.topHeader.isShowCompressLightBox},set:function(t){this.$store.state.topHeader.isShowCompressLightBox=t}}},methods:{changeUnsavedStatus(){this.$store.commit(s.nFE,{unSavedStatus:!0,isUpdatePage:!0})},isHasPopImg:function(t){return!!this.isHasAction&&!!Object.keys(this.actionList[t].popupImg).length},deleteAction:function(t){this.saveBeforePage(),this.actionList[t].popupImg={},this.curPopupImgEditItem="",this.saveUndo()},changeImg:function(t,e,i){if(i)this.curPopupImgEditItem.url=t.url,this.curPopupImgEditItem.isNewFile=!0,this.curPopupImgEditItem.fileName=n.Z.getPathFilename(t.url),this.curPopupImgEditItem.isLoadingThumb=!0,this.curPopupImgEditItem.name=t.name,this.isPopImgLoading=!1;else{const i=this.actionList[e].popupImg.imgList;for(let e=0;e<i.length;e++){const s=i[e];if(s.taskId&&s.taskId===t.taskId){s.url=t.url,s.fileName=t.fileName,s.name=t.name;break}}++this.uploadImageCount,this.checkAllFilesUploaded()}},fastAddCurrentImg:function(t){this.$store.commit(s.CjF),this.addNewPopImg(this.currentPopupImg,this.currentActionListIndex,!0),this.$store.commit(s.N23,{canUndo:!0})},addNewPopImg:function(t,e,i){this.isAllUploaded=!1;let s={isLoading:!0,isLoadingThumb:!0,url:"",title:"",desc:"",isNewFile:!0,fileName:"",name:""};t.taskId&&(s.taskId=t.taskId),i&&(s.url=t.url,s.fileName=n.Z.getPathFilename(s.url),s.isFastAdd=!0),this.actionList[e].popupImg.imgList.push(s)},popUpImgEditConfirm:function(t){this.actionList[t].popupImg.imgList.splice(this.curPopupImgEditImgListIndex,1,this.curPopupImgEditItem),this.changeUnsavedStatus(),this.popUpImgEditCancel(),this.saveUndo()},popUpImgEditCancel:function(){this.isEnterPopUpImgEdit=!1,this.curPopupImgEditItem="",this.curPopupImgEditIndex="",this.curPopupImgEditImgListIndex=""},deletePopImgListItem:function(t,e){this.saveBeforePage(),this.actionList[t].popupImg.imgList.splice(e,1),this.changeUnsavedStatus()},loadImg:function(t){let e=new Image;e.src=t.url,e.complete?t.isLoadingThumb=!1:e.onload=()=>{t.isLoadingThumb=!1}},changePopupImgIndex:function(t,e,i){if(e+i<0||e+i>this.actionList[t].popupImg.imgList.length-1)return;this.saveBeforePage();let s=this.actionList[t].popupImg.imgList.splice(e,1)[0],a=e+i;this.actionList[t].popupImg.imgList.splice(a,0,s),this.changeUnsavedStatus()},enterPopUpImgEditCase:function(t,e,i){this.isEnterPopUpImgEdit=!0,this.curPopupImgEditIndex=e,this.curPopupImgEditImgListIndex=i,this.curPopupImgEditItem=JSON.parse(JSON.stringify(t)),this.saveBeforePage()},showFastAddPopImg:function(t){void 0!==t&&this.curFastAddIndex!==t?(this.curFastAddIndex=t,this.isShowFastAddBtn=!0):(this.isShowFastAddBtn=!this.isShowFastAddBtn,this.curFastAddIndex="")},sortPopupImgListByName:function(t){if(1===this.actionList[this.currentActionListIndex].popupImg.imgList.length)return;const e=this.actionList[this.currentActionListIndex].popupImg.imgList.length-t;let i=this.actionList[this.currentActionListIndex].popupImg.imgList.slice(e);i.sort(((t,e)=>{if(t.name&&e.name)return this.sortImagesName(t.name,e.name)})),this.actionList[this.currentActionListIndex].popupImg.imgList.splice(e,this.actionList[this.currentActionListIndex].popupImg.imgList.length),this.actionList[this.currentActionListIndex].popupImg.imgList.push(...i)},sortImagesName:function(t,e){const i=/[\s!！#$%&(（)）,，、.。;；？@[\]^_`{}~‘’“”《》￥【】+=·…]/,s=/[0-9]/,a=/[A-Za-z]/,n=/[\u4E00-\u9FFF]/;let o=0,l=!1;const r=Math.min(t.length,e.length);do{const p=t.charAt(o),c=e.charAt(o),u=[p,c].map((t=>t.match(i)?0:t.match(s)?1:t.match(a)?2:t.match(n)?3:-1));if(p!==c){if(u[0]!==u[1]){l=u[0]-u[1];break}l=p.localeCompare(c,"zh");break}if(o===r){l=t.localeCompare(e,"zh");break}o+=1}while(o<=r);return l},checkAllFilesUploaded:function(){const t=this.actionList[this.currentActionListIndex].popupImg.imgList.length;this.uploadImageCount===t&&(this.isAllUploaded=!0,this.isStartUpload=!1,this.changeUnsavedStatus())},recordIsUpload:function(){this.isStartUpload=!0,this.saveBeforePage()},replaceImg(){this.$refs.ReplaceRef.selectFile()},imgCanBeSaveChange(){this.$store.commit(s.N23,{canUndo:!0})},async uploadSource(t){await this.CompressorFactory.addTasks(t,!1);if(1===this.CompressorFactory.taskList.length){let t=this.CompressorFactory.taskList[0].file;if("string"==typeof t.failType)return this.handleError(t.failType),void this.CompressorFactory.clearTask();if(0===t.failType.length||t.failType.includes("over_longest_size")&&1===t.failType.length)return await this.upload([t]),void this.CompressorFactory.clearTask();const e=Math.max(t.width,t.height)>this.longestSideSize;let i=this.$t("UpLoadPanel_vue.OverSize",{maxsize:this.imageLimit.maxSize/1024/1024,size:(t.space/1024/1024).toFixed(2)});e&&(i=this.$t("UpLoadPanel_vue.DimensionsOver",{dimensions:`${this.longestSideSize}*${this.longestSideSize}`,size:`${t.width}*${t.height}`})),(0,w.f2)(t.space)&&e&&(i=this.$t("UpLoadPanel_vue.DimensionsAndSize",{maxsize:this.imageLimit.maxSize/1024/1024,maxdimension:`${this.longestSideSize}*${this.longestSideSize}`,size:(t.space/1024/1024).toFixed(2),dimension:`${t.width}*${t.height}`}));let s=this.$t("AnimeAdvancedPanel_vue.text36"),a=this.$t("AnimeAdvancedPanel_vue.text37");this.$cusConfirm({title:this.$t("MenuForPathTool_vue.text7"),message:i,confirmButtonText:s,cancelButtonText:a,type:"warning"}).then((async e=>{this.isShowCompressLightBox=!0,await this.CompressorFactory.queueCompressor(),t=this.CompressorFactory.taskList[0].file,"string"!=typeof t.failType&&t.failType.includes("image_over_size")?this.$message.error(this.$t("UpLoadPanel_vue.failCompression")):(this.$message.success(this.$t("UpLoadPanel_vue.successCompression")),await this.upload([this.CompressorFactory.taskList[0].file])),this.CompressorFactory.clearTask(),this.isShowCompressLightBox=!1})).catch((()=>{this.$message.info(this.$t("UpLoadPanel_vue.cancelCompressed")),this.CompressorFactory.clearTask()}))}else{const t=this.CompressorFactory.taskList,e=[];for(let i=0;i<t.length;i++){if(0!==t[i].file.failType.length)return void(this.isShowMultUploadImagePanel=!0);e.push(t[i].file)}await this.upload(e),this.CompressorFactory.clearTask()}},CloseMultPanel(){this.isShowMultUploadImagePanel=!1},upload(t){const e=[];for(let i=0;i<t.length;i++){const s=t[i].file;let a={isLoading:!0,isLoadingThumb:!0,url:"",title:"",desc:"",isNewFile:!0,fileName:"",name:""};this.actionList[this.currentActionListIndex].popupImg.imgList.push(a);const o=new x.M({uploadStatus:"prepare",percentage:0,file:s,newTime:s.lastModified,name:s.name,space:s.size/1024});e.push(o.uploadFileToTemporary().then((t=>{a.fileName=n.Z.getPathFilename(t),a.url=t,a.name=s.name,++this.uploadImageCount})))}Promise.allSettled(e).then((()=>{this.checkAllFilesUploaded()}))},handleError(t){switch(t){case"image_over_size":case"gif_over_size":this.showMessage(this.$t("Message_js.imageSizeLimit",{size:this.curUserCanUpladImageSize/1024/1024+"MB"}),{type:"warning"});break;case"error_suffix":this.showMessage(this.$t("uploadFileSuffixNotice.warning2",{suffix:this.uploadPanelUploadAcceptArr.map((t=>t.toLocaleUpperCase())).join(" ")}),{type:"warning"});break;case"image_over_dimensions":{const t=this.$store.getters.longestSideSize;this.showMessage(this.$t("uploadFileSuffixNotice.longestSizeError2",{width:t,height:t}),{type:"warning"});break}case"svg_over_size":this.showMessage(this.$t("Message_js.svgSizeLimit",{size:this.svgLimit.maxSize/1024+"KB"}),{type:"warning"});break;case"json_over_size":this.showMessage(this.$t("Message_js.text5"),{type:"warning"});break;default:this.showMessage(this.$t("UpLoadPanel_vue.uploadResourceError",{type:this.$t("UpLoadPanel_vue.deleteImageType")}),{type:"error"})}},showMessage(t,e={type:"info"}){this.messageHandle&&this.messageHandle.close(),this.messageHandle=this.$message({...e,customClass:"el-message-custom-style",message:t})}}},k=(0,p.Z)(S,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"PopupImg group"},[e("div",{staticClass:"action-group item-group"},[e("div",{staticClass:"add-popupImg"},[e("UserFileSelect",{attrs:{"file-dialog-opts":t.imageUploadOptsMulti},on:{"upload-file-select":t.uploadSource}},[e("el-row",{staticClass:"editor_v2_white_btn upload_button",attrs:{type:"flex",align:"middle",justify:"center"}},[e("span",[t._v(" "+t._s(t.$t("rightPanel.action_addPopupImg"))+" ")])])],1),t.isShowFastAddButton?e("div",{key:"popupImg"+t.currentActionListIndex,staticClass:"btn btn-white",style:{height:"",marginTop:"10px"},on:{click:function(e){return e.stopPropagation(),t.fastAddCurrentImg.apply(null,arguments)}}},[e("span",{directives:[{name:"t",rawName:"v-t",value:"rightPanel.action_addSelfPopupImg",expression:"'rightPanel.action_addSelfPopupImg'"}]})]):t._e()],1),e("transition",{attrs:{name:"popupImgFastAdd"}}),t.isShowEditPanel?e("div",{staticClass:"popupImg-edit-panel"},[e("div",{staticClass:"popupImg-edit-panel_title"},[t._v(" "+t._s(t.$t("rightPanel.action_editImg"))+" ")]),e("div",{staticClass:"popupImg-edit-close-btn",on:{click:function(e){return e.stopPropagation(),t.popUpImgEditCancel.apply(null,arguments)}}},[e("el-icon",[e("CloseIcon",{tag:"component"})],1)],1),e("div",{staticClass:"popupImg-edit-bg",on:{click:t.replaceImg}},[t.curPopupImgEditItem&&t.curPopupImgEditItem.url&&!t.isPopImgLoading?e("img",{attrs:{src:t.curPopupImgEditItem.url,alt:""}}):t._e(),t.isPopImgLoading?e("div",{directives:[{name:"loading",rawName:"v-loading"}],staticClass:"uploading"},[e("i",{staticClass:"el-icon-loading loading-icon"})]):t._e(),e("div",{staticClass:"uploadImg"},[e("el-row",{staticStyle:{height:"100%"},attrs:{type:"flex",align:"middle",justify:"center"}},[e("el-icon",{staticStyle:{"margin-right":"5px"}},[e("ReplaceIcon",{tag:"component"})],1),e("span",{directives:[{name:"t",rawName:"v-t",value:"rightPanel.action_changePopupImg",expression:"'rightPanel.action_changePopupImg'"}]})],1),e("MutiUploadList",{ref:"ReplaceRef",attrs:{uploadTitle:t.$t("rightPanel.image_changeImage"),hasTipsLongestSize:!1,"file-dialog-opts":t.imageUploadOpts},on:{"upload-success":function(e){return t.changeImg(e,t.currentActionListIndex,!0)},"upload-before":function(e){t.isPopImgLoading=!0}}})],1)]),e("div"),e("div",{staticClass:"iframe-input-box"},[e("el-input",{staticClass:"props_el-input-h34",attrs:{placeholder:t.$t("menu.link")},on:{change:function(e){return t.changeInputList(t.currentActionListIndex,"popupImg")},keydown:function(t){t.stopPropagation()}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.popUpImgEditConfirm(t.currentActionListIndex)}},model:{value:t.imgLink,callback:function(e){t.imgLink=e},expression:"imgLink"}},[e("template",{slot:"prepend"},[t._v("https:")])],2)],1),e("div",{staticClass:"iframe-input-box"},[e("el-input",{staticClass:"props_el-input-h34",attrs:{placeholder:t.$t("rightPanel.action_popupImgTitle")},on:{change:function(e){return t.changeInputList(t.currentActionListIndex,"popupImg")},keydown:function(t){t.stopPropagation()}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.popUpImgEditConfirm(t.currentActionListIndex)}},model:{value:t.curPopupImgEditItem.title,callback:function(e){t.$set(t.curPopupImgEditItem,"title",e)},expression:"curPopupImgEditItem.title"}})],1),e("el-input",{staticClass:"props_el-input-textarea",staticStyle:{"margin-bottom":"15px"},attrs:{type:"textarea",placeholder:t.$t("rightPanel.action_popupImgDesc")},on:{change:function(e){return t.changeInputList(t.currentActionListIndex,"popupImg")},keydown:function(t){t.stopPropagation()}},model:{value:t.curPopupImgEditItem.desc,callback:function(e){t.$set(t.curPopupImgEditItem,"desc",e)},expression:"curPopupImgEditItem.desc"}}),e("div",{staticClass:"popupImg-edit-confirm-Box"},[e("p",{staticClass:"popupImg-cancel",on:{click:function(e){return e.stopPropagation(),t.popUpImgEditCancel.apply(null,arguments)}}},[e("span",{directives:[{name:"t",rawName:"v-t",value:"rightPanel.action_cancelEdit",expression:"'rightPanel.action_cancelEdit'"}]})]),e("p",{staticClass:"popupImg-confirm",on:{click:function(e){return e.stopPropagation(),t.popUpImgEditConfirm(t.currentActionListIndex)}}},[e("span",{directives:[{name:"t",rawName:"v-t",value:"rightPanel.action_confirmEdit",expression:"'rightPanel.action_confirmEdit'"}]})])])],1):t._e(),t.currentImgList.length?e("ul",{staticClass:"popupImg-list"},t._l(t.currentImgList,(function(i,s){return e("li",{key:s,staticClass:"popupImg-item"},[e("div",{staticClass:"img_box"},[e("img",{staticClass:"popupImg-img",style:{transform:"rotateX("+t.currentSelectedItem.rotateX+"deg) rotateY("+t.currentSelectedItem.rotateY+"deg)"},attrs:{src:i.url},on:{load:function(e){return t.loadImg(i)}}}),i.isLoadingThumb?e("div",{staticClass:"popupImg-loading"},[e("div",{staticClass:"loadingBox"})]):t._e()]),e("div",{staticClass:"title_box",class:{isLoading:i.isLoadingThumb},attrs:{title:i.title}},[t._v(" "+t._s(i.title)+" ")]),e("div",{staticClass:"actions_box"},[i.isLoadingThumb?t._e():e("div",{staticClass:"top_btn",class:{isDisabled:0===s},on:{click:function(e){return e.stopPropagation(),t.changePopupImgIndex(t.currentActionListIndex,s,-1)}}},[e("el-tooltip",{attrs:{content:t.$t("rightPanel.action_popupImg_up"),"open-delay":800,placement:"top"}},[e("el-icon",{attrs:{size:10}},[e("ArrowTopIcon",{tag:"component"})],1)],1)],1),i.isLoadingThumb?t._e():e("div",{staticClass:"down_btn",class:{isDisabled:s===t.currentImgList.length-1},on:{click:function(e){return e.stopPropagation(),t.changePopupImgIndex(t.currentActionListIndex,s,1)}}},[e("el-tooltip",{attrs:{content:t.$t("rightPanel.action_popupImg_down"),"open-delay":800,placement:"top"}},[e("el-icon",{attrs:{size:10}},[e("ArrowDownIcon",{tag:"component"})],1)],1)],1),i.isLoadingThumb?t._e():e("div",{staticClass:"edit_btn",on:{click:function(e){return e.stopPropagation(),t.enterPopUpImgEditCase(i,t.currentActionListIndex,s)}}},[e("el-tooltip",{attrs:{content:t.$t("rightPanel.action_editImg"),"open-delay":800,placement:"top"}},[e("el-icon",{attrs:{size:10}},[e("EditIcon",{tag:"component"})],1)],1)],1),e("div",{staticClass:"delete_btn",on:{click:function(e){return e.stopPropagation(),t.deletePopImgListItem(t.currentActionListIndex,s)}}},[e("el-tooltip",{attrs:{content:t.$t("rightPanel.action_popupImg_delete"),"open-delay":800,placement:"top"}},[e("el-icon",{attrs:{size:10}},[e("CloseIcon",{tag:"component"})],1)],1)],1)])])})),0):t._e()],1),t.isYZPro?e("el-checkbox",{staticClass:"img_can_be_save_checkbox",attrs:{"data-v":"v3"},on:{change:t.imgCanBeSaveChange},model:{value:t.imgCanBeSave,callback:function(e){t.imgCanBeSave=e},expression:"imgCanBeSave"}},[e("span",[t._v(t._s(t.$t("rightPanel.image_lonePress")))]),e("el-tooltip",{attrs:{placement:"top",enterable:!1,"open-delay":800},scopedSlots:t._u([{key:"content",fn:function(){return[e("span",{staticClass:"long_press_tip"},[t._v(t._s(t.$t("rightPanel.image_lonePressTip")))])]},proxy:!0}],null,!1,1659053175)},[e("el-icon",{staticStyle:{"font-size":"12px","margin-left":"3px","vertical-align":"text-bottom",cursor:"pointer"}},[e("InfoTipsIcon")],1)],1)],1):t._e(),t.isShowMultUploadImagePanel?e("MultiUploadImage",{attrs:{"compressor-factory":t.CompressorFactory,tipsSize:t.longestSideSize,hasSizeTips:!1},on:{close:t.CloseMultPanel,"upload-image":t.upload}}):t._e()],1)}),[],!1,null,"3d85f84d",null),P=k.exports}}]);