self.onmessage=function(e){let{pages:t,length:s,pageWidth:a,isDoubleCurrentPage:r}=e.data,o=[],l=[],i=t,n=0;if(s>0){let e=i[0],t=e.items;t.forEach((e=>{"pagination"===e.type&&(e.value=0-(2===e.isCustomPage?e.copyPagesArray[0]:0)+parseInt(e.startPageNumber||0===e.startPageNumber?e.startPageNumber:1))})),e.items=t.filter((e=>!(("pagination"===e.type||e.asyncLot)&&e.isAsyncRight)));let s=null;e.pagesList?(s=e.pagesList[0],s.pageColor=e.pageColor,s.isHasPageColor=e.isHasPageColor,s.items=e.items,s.totalTime=e.totalTime):s=e,l=[s]}let g=r?a/2:a;for(let e=1;e<s;e++){let t=[],s=[];const a=[...new Map(i[e].items.map((e=>[e.id,e]))).values()];if(i[e].isSinglePage||a.length&&a.forEach(((a,r)=>{if("component"===a.type)t=[...t,a],s=[...s,a];else if("pagination"===a.type||a.asyncLot){let{leftItems:o,rightItems:l}=p(a,g,!0,e,r);t=[...t,...o],s=[...s,...l]}else{let{leftItems:o,rightItems:l}=p(a,g,!1,e,r);t=[...t,...o],s=[...s,...l]}})),i[e].pagesList)i[e].pagesList[0].items=t,i[e].pagesList[1].items=s,Array.isArray(i[e].pageColor)||(i[e].pagesList[0].pageColor=i[e].pageColor,i[e].pagesList[1].pageColor=i[e].pageColor),i[e].isHasPageColor&&(i[e].pagesList[0].isHasPageColor=i[e].isHasPageColor,i[e].pagesList[1].isHasPageColor=i[e].isHasPageColor),i[e].pagesList[0].totalTime=i[e].totalTime,i[e].pagesList[1].totalTime=i[e].totalTime,l=[...l,i[e].pagesList[0],i[e].pagesList[1]];else{let t=2*e-1;i[e].items&&i[e].items.length&&i[e].items.forEach((e=>{"pagination"===e.type&&(e.value=t-(2===e.isCustomPage?e.copyPagesArray[0]:0)+parseInt(e.startPageNumber||0===e.startPageNumber?e.startPageNumber:1))})),l=[...l,i[e]]}}function p(e,t,s,a,r){let o=[],l=[];if("pagination"===e.type){let t=0;0!==a&&(t=e.isAsyncRight?2*parseInt(a):2*parseInt(a)-1),e.value=parseInt(t)-(2===e.isCustomPage?e.copyPagesArray[0]:0)+parseInt(e.startPageNumber||0===e.startPageNumber?e.startPageNumber:1)}if(parseFloat(e.style.left)+parseFloat(e.style.width)<=t)e.crossIndex=s?r:null,e.isCrossPageItem=!1,o=[...o,e];else if(parseFloat(e.style.left)>=t){let a=e;a.style.left=parseFloat(a.style.left)-t+"px",a.crossIndex=s?r:null,a.isCrossPageItem=!1,l=[...l,a]}else if(parseFloat(e.style.left)<t&&parseFloat(e.style.left)+parseFloat(e.style.width)>t){let s=f(e,!0);s.doublePagePosition="left",s.isCrossPageItem=!0,s.crossIndex=r,o=[...o,s];let a=f(e,!0);a.id=function(e=""){return n++,e+n+Math.random().toString().substring(3)+Date.now().toString().slice(-5)}(),a.doublePagePosition="right",a.isCrossPageItem=!0,a.crossIndex=r,a.style.left=parseFloat(a.style.left)-t+"px",l=[...l,a]}return{leftItems:o,rightItems:l}}function m(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function f(e,t){if(t=!!t,function(e){return Array.isArray(e)||null!==e&&"object"==typeof e&&e.length>=0&&e.length%1==0}(e)){const s=e.length,a=s<1024?new Array(s):[];for(let r=0;r<s;++r)a[r]=t?f(e[r],t):e[r];return a}if(function(e){return"[object Object]"===toString.call(e)}(e)){const s={};for(const a in e)m(e,a)&&(s[a]=t?f(e[a],t):e[a]);return s}return e}o=l,self.postMessage(o),self.close()};