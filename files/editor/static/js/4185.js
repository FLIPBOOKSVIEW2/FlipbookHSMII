"use strict";(self.webpackChunkeditor_cli=self.webpackChunkeditor_cli||[]).push([[4185],{44910:function(e,t,s){s.d(t,{Z:function(){return p}});var r=s(13638),i=s(73264),a=s(26648),o=s(48589),n=s(83808),c=s(37389),l=s(61632),u=s(7986),d=s(28671),h={name:"SystemResourceList",props:{resourceList:{require:!0,type:Array},resourceImageContainerStyle:{type:Object,default:function(){return{padding:"10px"}}},isHtml:{type:Boolean,default:!1,desc:"是否要用v-html渲染数据"},materialType:{type:String,default:""}},data(){return{yzGetMinLevelId:r.gu,popoverResource:null,imageStatus:new Map}},computed:{resourceLimit:function(){return this.$store.getters.resourceLimit},uType(){return this.$store.state.userData.uType},isYZPro:function(){return this.$store.getters.isYZPro},isH5Pro:function(){return this.$store.getters.isH5Pro},isXZPro:function(){return this.$store.getters.isXZPro},isFlipPro:function(){return this.$store.getters.isFlipPro},isAdmin:function(){return this.$store.state.userData.isAdmin}},methods:{formatInfo(e){const{name:t,author:s,isPixabay:r,pixabayUrl:i,pixabayFrom:a,id:o,localId:n,isFavorite:c,totalTime:l}=e;let h="";h=(0,d.K)({item:e,type:this.materialType}),"chart"===this.materialType&&e.chartCode&&(-1!==e.chartCode.chartClass.indexOf("柱状图")&&(h=this.$t("ResourceCardNew.BarChart")),-1!==e.chartCode.chartClass.indexOf("折线图")&&(h=this.$t("ResourceCardNew.LineChart")),-1!==e.chartCode.chartClass.indexOf("饼图")&&(h=this.$t("ResourceCardNew.PieChart")));let p="",m=(0,u.A)(l);return p="number"==typeof e.newTime?e.newTimeFormat:e.updateTime||e.newTime,new u.k({newTime:p,totalTime:m,classify:h,name:this.isXZPro?"":t,author:s,keywords:e.resourceInfo,isPixabay:r,pixabayUrl:i,pixabayFrom:a,type:"resource",id:o||n,isFavorite:c})},isShowCollect(e){const t=e.type,s=e.svgClass;return("svg"!==t||"shape"!==s)&&"transShape"!==t&&"baseShape"!==t&&"chart"!==t},updatePop(e){this.$nextTick((()=>{this.$refs.resourceCardRef[e].updatePopper()}))},popoverShow(e){this.popoverResource=e},popoverHide(e){e.localId===this.popoverResource.localId&&(this.popoverResource=null)},addResource(e){this.$emit("notify-add",e)},addLike(e){this.$emit("notify-favorite",e)},materialMouseenter(e){this.$refs[`VersionRef_${e.localId}`]&&this.$refs[`VersionRef_${e.localId}`][0].show(),(0,n.z)(e)},materialMouseleave(e){this.$refs[`VersionRef_${e.localId}`]&&this.$refs[`VersionRef_${e.localId}`][0].hide(),(0,n.v)()},resToTop(e,t){this.$emit("resToTop",e,t)}},directives:{drag2Add:i.Z},components:{ImageSkeleton:a.Z,ResourceCardNew:o.Z,loadBgImage:c.Z,LoadingSkeletonBox:l.default}},p=(0,s(1001).Z)(h,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"editor_resource_list"},e._l(e.resourceList,(function(s,r){return t("div",{key:s.localId,staticClass:"resource_item"},[s.isLoadingRes?[t("el-skeleton",{staticClass:"imageSkeleton",attrs:{loading:!0,animated:""}},[t("template",{slot:"template"},[t("el-skeleton-item",{staticClass:"imageSkeleton"})],1)],2)]:[t("el-row",{staticClass:"resource_image_container",style:e.resourceImageContainerStyle},[t("div",{directives:[{name:"drag2Add",rawName:"v-drag2Add",value:{item:s},expression:"{\n              item: resource,\n            }"}],staticClass:"resource_image",on:{click:function(t){return e.addResource(s)},mouseenter:function(t){return e.materialMouseenter(s)},mouseleave:function(t){return e.materialMouseleave(s)}}},[t("LoadingSkeletonBox",{key:"Loading"+s.localId,attrs:{src:s.url_shot,fit:"contain",imageStatus:e.imageStatus}})],1)]),t("el-row",{staticClass:"resource_operate",attrs:{type:"flex",justify:"space-between"}},[t("el-row",{staticClass:"resource_operate_top",attrs:{type:"flex",justify:"end",align:"start"}},[e.isFlipPro?e._e():t("el-popover",{ref:"resourceCardRef",refInFor:!0,attrs:{"append-to":"editor_resource_list",width:"200",placement:r%2==0?"bottom":"bottom-end","visible-arrow":!1,"popper-class":"resource_popover"},on:{show:function(t){return e.popoverShow(s)},hide:function(t){return e.popoverHide(s)}}},[t("el-row",{staticClass:"resource_more",class:{moreVisible:e.popoverResource&&e.popoverResource.localId===s.localId},attrs:{slot:"reference",type:"flex",justify:"center",align:"middle"},slot:"reference"},[t("i",{staticClass:"el-icon-more"})]),t("el-row",{staticClass:"resource_info"},[t("ResourceCardNew",{attrs:{"resource-info":e.formatInfo(s),"show-collect-btn":e.isXZPro&&e.isShowCollect(s)},on:{"update-pop":function(t){return e.updatePop(r)},"add-like":()=>e.addLike(s)}},["component"===e.materialType&&e.isAdmin?t("el-row",{staticClass:"resource_icons",attrs:{type:"flex"}},[t("el-row",{staticClass:"e_plr_15"},[t("el-divider",{staticClass:"card-divider"})],1),t("el-row",{staticClass:"resource_icon_row e_plr_15",attrs:{type:"flex",align:"middle"},nativeOn:{click:function(t){return e.resToTop(s.id,!0)}}},[t("span",[e._v(e._s(e.$t("KeywordPanel_vue.text8")))])]),t("el-row",{staticClass:"resource_icon_row e_plr_15",attrs:{type:"flex",align:"middle"},nativeOn:{click:function(t){return e.resToTop(s.id,!1)}}},[t("span",[e._v(e._s(e.$t("KeywordPanel_vue.text9")))])])],1):t("el-row",{staticClass:"e_pb_15"})],1)],1)],1)],1),1===parseFloat(s.isCommercial)&&(e.isYZPro||e.isXZPro)?t("icon-commercial",{staticClass:"icon-commercial system_resource_icon",attrs:{placement:"bottom-left"}}):e._e(),e.isXZPro&&e.uType<s.range&&"transShape"!==s.type?t("icon-version",{ref:`VersionRef_${s.localId}`,refInFor:!0,staticClass:"system_resource_icon",attrs:{isBindParent:!1,"level-id":s.range}}):e._e(),!e.isYZPro&&!e.isH5Pro||e.resourceLimit.includes(Number(s.range))?e._e():t("icon-version",{ref:`VersionRef_${s.localId}`,refInFor:!0,staticClass:"system_resource_icon",attrs:{"level-id":e.yzGetMinLevelId({type:"resource",resRange:Number(s.range)}),isBindParent:!1,placement:"bottom-right"}})],1)]],2)})),0)])}),[],!1,null,"5bca0af8",null).exports},73145:function(e,t,s){s.d(t,{E:function(){return o}});var r=s(97873),i=(s(21703),s(68939)),a=s(46450);s(63722);class o extends a.m{constructor(e=0,t=20,s="h5"){super(e,t,s),(0,r.Z)(this,"cancelHandle",{system:null,search:null,favorite:null})}fetchSystemResource(e,t){const s=Object.assign({},e,this.pagingParams);return i.Z.post(t,s,{cancelToken:new i.Z.CancelToken((e=>{this.cancelHandle.system=e}))}).then((e=>{const{data:t}=e})).catch((e=>{throw Error(e.message)})).finally((()=>{}))}fetchFavoriteResource(e,t){return i.Z.post(t,e,{cancelToken:new i.Z.CancelToken((e=>{this.cancelHandle.favorite=e}))}).then((e=>{const{data:t}=e,s=Number(e.data.status)||e.data.code.toUpperCase();if(1!==s&&"OK"!==s)throw Error(t.msg)})).catch((e=>{if("canceled"!==e.message)throw Error(e.message)})).finally((()=>{}))}}},88418:function(e,t,s){s.d(t,{y:function(){return u}});s(57658);var r=s(94414),i=s(18023),a=s(43232),o=s(69367),n=s(63722),c=s(73145),l=s(45197);const u={props:{showChildTitle:{type:Boolean,default:!0,desc:"是否显示子组件title组件"}},data(){return{classifyCells:[],resourceList:[],resourceTool:null,isIniting:!1,isLoadingMore:!1,noMoreData:!1,virtualStartIndex:-1,virtualEndIndex:-1,classify:new l.v({id:-1,name:"全部"}),hasLocalResource:!1,rangeCode:-1}},computed:{isXZPro(){return this.$store.getters.isXZPro},isH5Pro:function(){return this.$store.getters.isH5Pro},project(){return this.$store.state.project},secMenuSearchValue:{get(){return this.$store.state.menuPanel.secMenuSearchValue},set(e){this.$store.state.menuPanel.secMenuSearchValue=e}},materialInfo(){return(0,o.pu)(this.project).find((e=>e.value===this.materialType))},resourceVisibleList(){return-1!==this.virtualStartIndex&&-1!==this.virtualEndIndex?this.resourceList.slice(this.virtualStartIndex,this.virtualEndIndex):this.resourceList}},mounted(){if(this.resourceTool=new c.E(this.isXZPro?0:1,36,this.project),this.materialInfo){const e=(0,l.O)(this.materialInfo.id);e&&(this.classifyCells=Object.freeze(e.secondCate))}this.init()},methods:{init(){this.resetData(),this.isIniting=!0,this.getMaterialData().then((()=>{this.hasLocalResource&&this.insertLocalSystemResource()}))},setStorageSearchValue:function(e){this.$store.commit(i.F$g,{newSearchValue:e,type:"searchValueList"})},onSearch(e){this.secMenuSearchValue=e,this.setStorageSearchValue(e),this.init()},resetData(){this.resourceList=[],this.noMoreData=!1,this.isLoadingMore=!1,this.resourceTool.reset()},getMaterialByClassifyChange(e){this.classify=e,this.init()},visibleRangeChange(e,t){this.virtualEndIndex=t,this.virtualStartIndex=e},loadMoreData(){if(!(this.noMoreData||this.isLoadingMore||this.isIniting))return this.isLoadingMore=!0,this.getMaterialData()},getMaterialData(e=null){const t=e||this.classify,s=Object.assign({sortType:2,isCommercial:1},t&&-1!==t.id?{secondId:t.id}:{firstIds:this.materialInfo.id},this.secMenuSearchValue?{keywords:this.secMenuSearchValue}:{},-1!==this.rangeCode?{rangeCode:this.rangeCode}:{});return this.resourceTool.fetchSystemResource(s,`${this.$store.getters.host}/${r.C.systemResource}`).then((({list:e})=>{this.isIniting=!1,this.isLoadingMore=!1,e&&this.addSystemResource(e.map((e=>new n.v1({item:e,type:this.materialType})))),this.isLoadingMore=!1})).catch((e=>{"canceled"!==e.message&&(this.isLoadingMore=!1,this.isIniting=!1)})).finally((()=>{}))},addSystemResource(e){const t=e;this.noMoreData=t.length<this.resourceTool.pageSize,this.resourceList.push(...t)},addResource(e){(0,a._R)(e,this.materialType)},insertLocalSystemResource(){},changeFavorite(e){if(!e.id)return;const t="component"===this.materialType;e.isFavorite="1"===e.isFavorite?"0":"1";const s="1"===e.isFavorite?"素材收藏成功，可到<span style='cursor:pointer;text-decoration: underline;'>【素材库-收藏素材】</span>中查看！":"取消收藏成功！";(0,a.dE)({tool:this.resourceTool,systemResource:e,message:s,isComponent:t})},getMaterialByRangeChange(e){this.rangeCode=e,this.init()}},components:{}}},46450:function(e,t,s){s.d(t,{m:function(){return i}});var r=s(97873);class i{constructor(e=0,t=20,s="h5"){(0,r.Z)(this,"originPageIndex",1),(0,r.Z)(this,"pageIndex",1),(0,r.Z)(this,"pageSize",20),(0,r.Z)(this,"project","h5"),(0,r.Z)(this,"cancelHandle",{}),this.pageIndex=e,this.originPageIndex=e,this.pageSize=t,this.project=s}reset(){this.pageIndex=this.originPageIndex,this.cancelOtherPost("")}cancelOtherPost(e){Object.keys(this.cancelHandle).forEach((t=>{t!==e&&this.cancelHandle[t]&&(this.cancelHandle[t](),this.cancelHandle[t]=null)}))}get pagingParams(){return"xz"===this.project?{pageSize:this.pageSize,pageIndex:this.pageIndex}:{size:this.pageSize,current:this.pageIndex}}}}}]);