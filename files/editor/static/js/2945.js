"use strict";(self.webpackChunkeditor_cli=self.webpackChunkeditor_cli||[]).push([[2945],{86602:function(e,t,i){i.r(t),i.d(t,{default:function(){return s}});var o=i(25986),n=i(18023);var a={name:"VideoClip",mixins:[{methods:{timeFormat:function(e,t){let i=e.toFixed(2),o=0,n=i.substring(i.lastIndexOf("."),0),a=i.substring(i.lastIndexOf(".")+1);return n>=60&&(o=parseInt(n/60),n=parseInt(n%60)),n<10&&!t&&(n="0"+n),o<10&&!t&&(o="0"+o),{minute:o,second:t?Number(n):n,millisecond:t?Number(a):a}}},directives:{clip:{bind:function(e,t,i){let o=i.context,n=t.value.isLeft;e.onmousedown=e=>{let t=e.clientX,i=n?o.startTimeLeft:o.endTimeLeft,a=0,s=o.barWidth/100;o.showNoticOne||(document.onmousemove=e=>{if(o.showNoticOne)return;let l=e.clientX-t;a=i+l/s,n?(a<=0&&(a=0),a+o.minDurationPercent>=o.endTimeLeft&&(a=o.endTimeLeft-o.minDurationPercent),o.startTimeLeft=a):(a>=100&&(a=100),a-o.minDurationPercent<=o.startTimeLeft&&(a=o.startTimeLeft+o.minDurationPercent),o.endTimeLeft=a)},document.onmouseup=e=>{document.onmousemove=null,document.onmouseup=null})}}},dragTime:{bind:function(e,t,i){let o=i.context;e.onmousedown=e=>{let t=e.clientX,i=o.mediaInfo.duration/o.barWidth,n=o.playTime;o.showNoticOne||(document.onmousemove=e=>{o.isPlaying&&o.playOrPause();let a=e.clientX-t,s=n+a*i;s<=0&&(s=0),s>=o.mediaInfo.duration&&(s=o.mediaInfo.duration),o.playTime=s},document.onmouseup=e=>{document.onmousemove=null,document.onmouseup=null})}}},drgClipShadow:{bind:function(e,t,i){let o=i.context;e.onmousedown=e=>{let t=e.clientX,i=0,n=o.startTimeLeft,a=o.endTimeLeft,s=0,l=0,c=o.barWidth/100;o.showNoticOne||(document.onmousemove=e=>{if(o.showNoticOne)return;let r=e.clientX-t;i=r/c,s=n+i,l=a+i,(s<=0||l>=100)&&(s<=0&&(s=0,l=o.clipPercent),l>=100&&(l=100,s=100-o.clipPercent)),o.startTimeLeft=s,o.endTimeLeft=l},document.onmouseup=e=>{document.onmousemove=null,document.onmouseup=null})}}}}}],data(){return{playTime:0,isPlaying:!1,videoPlayer:null,timer:null,showNoticOne:!1,showNoticTwo:!1,startTimeLeft:30,endTimeLeft:50,barWidth:500,localFadeIn:0,localFadeOut:0,localVideoAnimeDuration:0,localVideoRepeatTime:1,isReplay:!1,noticeTimer:null,showClipTime:!0}},props:[],watch:{clipTimeFormate(){const e=this.$refs.timeLongRef;e&&0!==e.offsetWidth&&(this.showClipTime=!(e.offsetWidth<e.scrollWidth))}},created:function(){},mounted:async function(){let e=this.videoDuration,t=this.mediaInfo;this.playTime=t.startTime,this.startTimeLeft=t.startTime/e*100,this.endTimeLeft=t.endTime/e*100,this.localVideoAnimeDuration=this.videoAnimeDuration,this.localFadeIn=t.fadeIn,this.localFadeOut=t.fadeOut,this.keepRatio?this.localVideoRepeatTime=Number((this.videoAnimeDuration/(this.localEndTime-this.localStartTime)).toFixed(1)):this.localVideoRepeatTime=1,setTimeout((()=>{this.videoPlayer=this.$refs.clipVideo}),400),e<=2&&(this.showNoticOne=!0),await this.$nextTick();const i=this.$refs.timeLongRef;this.showClipTime=!(i.offsetWidth<i.scrollWidth)},updated:function(){},beforeDestroy:function(){},computed:{modelOneRepeatDuration:function(){return((this.localEndTime-this.localStartTime)*this.localVideoRepeatTime).toFixed(2)},modelTwoRepeatTime:function(){return(this.localVideoAnimeDuration/(this.localEndTime-this.localStartTime)).toFixed(1)},localVideoAnimeDurationSec:{get:function(){return Number(this.localVideoAnimeDuration.toFixed(2))},set:function(e){let t=Number(e);"number"!=typeof t&&(t=2),this.localVideoAnimeDuration=t}},currentSelectedItem:function(){return this.$store.getters.currentSelectedItem},videoAnimeDuration:function(){return this.mediaInfo.duration},currentSelectedItemIndex:function(){return this.$store.state.workSpace.currentSelectedItemIndex},pageConfig:function(){return this.$store.state.pagePanel.pageConfig},lightboxTitle:function(){return this.$i18n.t("VideoClip_vue.text3")},isBGI:function(){return this.currentSelectedItem.isBGI},titleLabel:function(){return this.$i18n.t("VideoClip_vue.text4")},mediaInfo:function(){return this.currentSelectedItem.videoInfo},videoDuration:function(){return this.mediaInfo.originDuration},showVideoClipPanel:{get:function(){return this.$store.state.rightPanel.showVideoClipPanel},set:function(e){this.$store.state.rightPanel.showVideoClipPanel=e}},localVideoAnimeDurationFormate:function(){let e=this.timeFormat(this.localVideoAnimeDuration);return`${e.minute}:${e.second}.${e.millisecond}`},playTimeFormate:function(){let e=this.timeFormat(this.playTime);return`${e.minute}:${e.second}.${e.millisecond}`},durationFormate:function(){let e=this.timeFormat(this.videoDuration);return`${e.minute}:${e.second}.${e.millisecond}`},startTimeFormate:function(){let e=this.timeFormat(this.localStartTime);return`${e.minute}:${e.second}.${e.millisecond}`},endTimeFormate:function(){let e=this.timeFormat(this.localEndTime);return`${e.minute}:${e.second}.${e.millisecond}`},clipTimeFormate:function(){let e=this.timeFormat(this.localEndTime-this.localStartTime);return`${e.minute}:${e.second}.${e.millisecond}`},curTimeLineLeft:function(){return this.playTime/this.videoDuration*100},videoRepeatTime:function(){let e=(this.videoAnimeDuration/(this.videoEndTime-this.videoStartTime)).toFixed(1);return e<1&&(e=1),e},videoStartTime:{get:function(){return this.mediaInfo.startTime},set:function(e){this.mediaInfo.startTime=e}},videoEndTime:{get:function(){return this.mediaInfo.endTime},set:function(e){this.mediaInfo.endTime=e}},videoFadeIn:{get:function(){return this.mediaInfo.fadeIn},set:function(e){this.mediaInfo.fadeIn=e}},videoFadeOut:{get:function(){return this.mediaInfo.fadeOut},set:function(e){this.mediaInfo.fadeOut=e}},noChange:function(){return this.localStartTime===this.videoStartTime&&this.localEndTime===this.videoEndTime&&this.localVideoRepeatTime===this.videoRepeatTime&&this.localVideoAnimeDuration===this.videoAnimeDuration&&this.localFadeIn===this.videoFadeIn&&this.localFadeOut===this.videoFadeOut},controlShadowStyle:function(){return{left:`calc(${this.startTimeLeft}% - 8px)`,right:`calc(${100-parseFloat(this.endTimeLeft)}% - 8px)`}},minClipMusicDuration:function(){return this.$store.state.timeline.minClipMusicDuration},minDurationPercent:function(){return this.minClipMusicDuration/this.videoDuration*100},clipPercent:function(){return(this.localEndTime-this.localStartTime)/this.videoDuration*100},localStartTime:function(){return this.videoDuration*this.startTimeLeft/100},localEndTime:function(){return this.videoDuration*this.endTimeLeft/100},keepRatio:{get:function(){return this.currentSelectedItem.videoInfo.isLockedRepeat},set:function(e){this.currentSelectedItem.videoInfo.isLockedRepeat=e}}},methods:{clipVideo:function(){if(!this.noChange){this.videoStartTime=this.localStartTime,this.videoEndTime=this.localEndTime,this.videoFadeIn=this.localFadeIn,this.videoFadeOut=this.localFadeOut;let e=0;this.keepRatio?e=this.localVideoRepeatTime*(this.localEndTime-this.localStartTime):(e=this.localVideoAnimeDuration,this.localEndTime-this.localStartTime>e&&(e=this.localEndTime-this.localStartTime)),this.keepRatio&&(this.currentSelectedItem.videoInfo.repeatTime=this.localVideoRepeatTime),this.currentSelectedItem.videoInfo.duration=e,this.$store.commit(n.AST),this.$store.commit(n.N23,{canUndo:!0})}},playOrPause:function(){this.videoPlayer&&(this.isPlaying?(clearTimeout(this.timer),this.videoPlayer.pause()):this.playTime>=this.videoDuration?this.videoReplay():(this.isReplay=!1,this.videoPlayer.currentTime=this.playTime,this.videoPlayer.play()))},videoReplay:function(){this.videoPlayer&&(this.isReplay=!0,clearTimeout(this.timer),this.videoPlayer.currentTime=this.localStartTime,this.videoPlayer.play())},volumeChange:function(){this.$store.commit(n.N23,{canUndo:!0})},videoTimeupdate:function(){if(this.playTime=this.videoPlayer.currentTime,this.isReplay){if(this.playTime-this.localStartTime<=this.localFadeIn&&0!==this.localFadeIn){let e=(this.playTime-this.localStartTime)/Number(this.localFadeIn);e=e<0?0:e,this.videoPlayer.volume=e}if(this.localEndTime-this.playTime<=this.localFadeOut&&0!==this.localFadeOut){let e=(this.localEndTime-this.playTime)/Number(this.localFadeOut);e=e<0?0:e,this.videoPlayer.volume=e}this.playTime>=this.localEndTime&&(this.playTime=this.localEndTime,this.videoPlayer.pause())}else this.playTime>=this.videoDuration&&(this.playTime=this.videoDuration,this.videoPlayer.pause())},videoError:function(){this.isPlaying=!1},videoPlay:function(){this.isPlaying=!0},videoPause:function(){this.isPlaying=!1},getReapeatTime:function(){let e=this.localVideoAnimeDuration/(this.localEndTime-this.localStartTime);this.localVideoRepeatTime=e.toFixed(2)},getVideoAnimeTime:function(){let e=this.localVideoRepeatTime*(this.localEndTime-this.localStartTime);this.localVideoAnimeDuration=e},lock:function(){this.keepRatio=!this.keepRatio},repeatChange:function(e){this.localVideoRepeatTime=e,this.getVideoAnimeTime()},modelTwoBlur:function(e){this.localVideoAnimeDuration<this.localEndTime-this.localStartTime&&(this.localVideoAnimeDuration=this.localEndTime-this.localStartTime,this.noticeTimer&&this.noticeTimer.close(),this.noticeTimer=this.$message({showClose:!0,message:this.$i18n.t("MusicClip copy_vue.text22"),type:"warning",duration:4e3}))}},components:{Lightbox:o.default,PlayIcon:()=>i.e(5489).then(i.bind(i,75489)),ArrowIcon:()=>i.e(6602).then(i.bind(i,52247)),PauseIcon:()=>i.e(9551).then(i.bind(i,19551)),PlayCutIcon:()=>i.e(911).then(i.bind(i,70911)),PropsInput:()=>i.e(9706).then(i.bind(i,49706))}},s=(0,i(1001).Z)(a,(function(){var e=this,t=e._self._c;return e.showVideoClipPanel?t("Lightbox",{attrs:{isShow:e.showVideoClipPanel,title:e.lightboxTitle,showConfirm:!0,confirmCallBack:e.clipVideo,customStyle:{width:"100%",maxWidth:"960px"}},on:{"update:isShow":function(t){e.showVideoClipPanel=t},"update:is-show":function(t){e.showVideoClipPanel=t}}},[t("div",{staticClass:"videoCon"},[t("div",{staticClass:"video_left"},[t("div",{staticClass:"video_box"},[t("video",{ref:"clipVideo",attrs:{src:e.mediaInfo.url,id:"clipVideo",width:"100%",height:"100%"},on:{error:e.videoError,timeupdate:e.videoTimeupdate,pause:e.videoPause,play:e.videoPlay}}),t("div",{staticClass:"video_title"},[e._v(e._s(e.mediaInfo.name))]),t("div",{staticClass:"video_time"},[e._v(e._s(e.playTimeFormate)+"/"+e._s(e.durationFormate))])]),t("div",{staticClass:"clip_box"},[t("el-tooltip",{attrs:{content:e.isPlaying?e.$t("MusicClip_vue.Pause"):e.$t("MusicClip_vue.Play"),placement:"top","open-delay":800}},[t("div",{staticClass:"playOrPause",on:{click:e.playOrPause}},[t("el-icon",[t(e.isPlaying?"PauseIcon":"PlayIcon",{tag:"component"})],1)],1)]),t("el-tooltip",{attrs:{content:e.$t("MusicClip_vue.Replay"),placement:"top","open-delay":800}},[t("div",{staticClass:"playOrPause",on:{click:e.videoReplay}},[t("el-icon",[t("PlayCutIcon",{tag:"component"})],1)],1)]),t("el-row",{staticClass:"durationBar"},[t("div",{directives:[{name:"drgClipShadow",rawName:"v-drgClipShadow"}],staticClass:"container",style:e.controlShadowStyle},[t("span",{ref:"timeLongRef",staticClass:"curTime",class:{isHide:!e.showClipTime}},[e._v(e._s(e.clipTimeFormate))])]),t("div",{directives:[{name:"dragTime",rawName:"v-dragTime"}],staticClass:"controlLine",style:{left:e.curTimeLineLeft+"%"}}),t("span",{directives:[{name:"clip",rawName:"v-clip",value:{isLeft:!0},expression:"{ isLeft: true }"}],staticClass:"borderLine leftLine",style:{left:`calc(${e.startTimeLeft}% - 8px)`}},[t("el-icon",{staticClass:"control-pointer"},[t("ArrowIcon",{tag:"component"})],1)],1),t("span",{directives:[{name:"clip",rawName:"v-clip",value:{isLeft:!1},expression:"{ isLeft: false }"}],staticClass:"borderLine rightLine",style:{left:`${e.endTimeLeft}%`}},[t("el-icon",{staticClass:"control-pointer"},[t("ArrowIcon",{tag:"component"})],1)],1)])],1)]),t("div",{staticClass:"video_right"},[t("div",{staticClass:"section_box"},[t("div",{staticClass:"title"},[e._v(e._s(e.$t("MusicClip_vue.text11")))]),t("el-row",{staticClass:"fadeSetting",attrs:{type:"flex",align:"middle"}},[t("PropsInput",{attrs:{settingValue:e.localFadeIn,title:e.$t("MusicClip_vue.text12"),min:0,prefix:e.$t("MusicClip_vue.prefix"),step:1,iptW:115,type:"number"},on:{"update:settingValue":function(t){e.localFadeIn=t},"update:setting-value":function(t){e.localFadeIn=t}}}),t("PropsInput",{attrs:{settingValue:e.localFadeOut,title:e.$t("MusicClip_vue.text13"),min:0,step:1,prefix:e.$t("MusicClip_vue.prefix"),iptW:115,type:"number"},on:{"update:settingValue":function(t){e.localFadeOut=t},"update:setting-value":function(t){e.localFadeOut=t}}})],1)],1),t("div",{staticClass:"section_box"},[t("div",{staticClass:"title"},[e._v(e._s(e.$t("MusicClip_vue.text14")))]),t("el-row",{staticClass:"loadSetting"},[t("div",{staticClass:"set_item"},[t("el-radio",{attrs:{"data-v":"v2",label:!0},model:{value:e.keepRatio,callback:function(t){e.keepRatio=t},expression:"keepRatio"}},[e._v(e._s(e.$t("MusicClip_vue.text15")))]),t("div",{staticClass:"clip_row"},[t("span",[e._v(e._s(e.$t("MusicClip_vue.text16_1")))]),t("span",{staticClass:"clipInput"},[t("el-input",{staticClass:"props_el-input-h34",attrs:{"data-v":"v2",disabled:!e.keepRatio,type:"number",min:1},model:{value:e.localVideoRepeatTime,callback:function(t){e.localVideoRepeatTime=t},expression:"localVideoRepeatTime"}})],1),t("span",[e._v(e._s(e.$t("MusicClip_vue.text16_2",{PARAM:e.modelOneRepeatDuration})))])])],1),t("div",{staticClass:"set-border-line"}),t("div",{staticClass:"set_item"},[t("el-radio",{attrs:{"data-v":"v2",label:!1},model:{value:e.keepRatio,callback:function(t){e.keepRatio=t},expression:"keepRatio"}},[e._v(e._s(e.$t("MusicClip_vue.text17")))]),t("div",{staticClass:"clip_row"},[t("span",[e._v(e._s(e.$t("MusicClip_vue.text18")))]),t("span",{staticClass:"clipInput clipTwo"},[t("el-input",{staticClass:"props_el-input-h34",attrs:{"data-v":"v2",disabled:e.keepRatio,type:"number",min:this.localEndTime-this.localStartTime},on:{blur:e.modelTwoBlur},model:{value:e.localVideoAnimeDurationSec,callback:function(t){e.localVideoAnimeDurationSec=t},expression:"localVideoAnimeDurationSec"}})],1),t("span",[e._v(" "+e._s(e.$t("MusicClip_vue.text19",{PARAM:e.modelTwoRepeatTime}))+" ")])])],1)])],1)])])]):e._e()}),[],!1,null,"48055672",null).exports}}]);